CREATE TABLE T24_LNMEMO_ACTIVITY_ACC
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_ACC_REC_WIN_ID
    ON T24_LNMEMO_ACTIVITY_ACC (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_ACC_WINDOW_ID
    ON T24_LNMEMO_ACTIVITY_ACC (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNMEMO_ACTIVITY_ARR
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_ARR_REC_WIN_ID
    ON T24_LNMEMO_ACTIVITY_ARR (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_ARR_WINDOW_ID
    ON T24_LNMEMO_ACTIVITY_ARR (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNMEMO_ACTIVITY_BIL
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_BIL_REC_WIN_ID
    ON T24_LNMEMO_ACTIVITY_BIL (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_BIL_WINDOW_ID
    ON T24_LNMEMO_ACTIVITY_BIL (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNMEMO_ACTIVITY_ECB
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_ECB_REC_WIN_ID
    ON T24_LNMEMO_ACTIVITY_ECB (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNMEMO_ACTIVITY_ECB_WINDOW_ID
    ON T24_LNMEMO_ACTIVITY_ECB (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNTNEW_ACTIVITY_ACC
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_ACC_REC_WIN_ID
    ON T24_LNTNEW_ACTIVITY_ACC (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_ACC_WINDOW_ID
    ON T24_LNTNEW_ACTIVITY_ACC (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNTNEW_ACTIVITY_AIT
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_AIT_REC_WIN_ID
    ON T24_LNTNEW_ACTIVITY_AIT (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_AIT_WINDOW_ID
    ON T24_LNTNEW_ACTIVITY_AIT (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNTNEW_ACTIVITY_ARR
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_ARR_REC_WIN_ID
    ON T24_LNTNEW_ACTIVITY_ARR (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_ARR_WINDOW_ID
    ON T24_LNTNEW_ACTIVITY_ARR (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNTNEW_ACTIVITY_ASC
(
    RECID     VARCHAR2(255),
    WINDOW_ID NUMBER(25)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_ASC_REC_WIN_ID
    ON T24_LNTNEW_ACTIVITY_ASC (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_T24_LNTNEW_ACTIVITY_ASC_WINDOW_ID
    ON T24_LNTNEW_ACTIVITY_ASC (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE T24_LNMEMO_ACTIVITY
(
    SEQUENCE_NO  NUMBER(18, 0) GENERATED ALWAYS AS IDENTITY,
    ACCTNO       NUMBER(19, 0),
    CURTYP       VARCHAR2(4),
    CBAL         NUMBER(15, 2),
    HOLD         NUMBER(15, 2),
    DRLIMT       NUMBER(15, 2),
    ACCINT       NUMBER(17, 5),
    COMACC       NUMBER(15, 5),
    OTHCHG       NUMBER(13, 2),
    BILPRN       NUMBER(15, 2),
    BILINT       NUMBER(15, 2),
    BILESC       NUMBER(13, 2),
    BILLC        NUMBER(15, 2),
    BILOC        NUMBER(13, 2),
    BILMC        NUMBER(13, 2),
    WINDOW_ID    NUMBER(25, 0),
    COMMIT_TS    TIMESTAMP(3),
    REPLICAT_TS  TIMESTAMP(3),
    MAPPED_TS    TIMESTAMP(3),
    CHANGED_TIME TIMESTAMP(3) DEFAULT SYSTIMESTAMP,
    CALL_CDC     VARCHAR2(3),
    CONSTRAINT PK_T24_LNMEMO_ACTIVITY PRIMARY KEY (SEQUENCE_NO)
)
    TABLESPACE T24RAWOGG
    PARTITION BY RANGE (CHANGED_TIME)
    INTERVAL (NUMTODSINTERVAL(1, 'DAY'))
(
    PARTITION P1 VALUES LESS THAN (TIMESTAMP '2024-01-01 00:00:00')
        LOGGING
        NOCOMPRESS
        TABLESPACE T24RAWOGG
        PCTFREE 10
        INITRANS 5
        MAXTRANS 255
        STORAGE (
        INITIAL 1024M
        NEXT 1M
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
        BUFFER_POOL DEFAULT
        )
)
    NOCACHE
    MONITORING;

CREATE TABLE T24_LNTNEW_ACTIVITY
(
    SEQUENCE_NO  NUMBER(18, 0) GENERATED ALWAYS AS IDENTITY,
    BRN          CHAR(9),
    ACCTNO       NUMBER(19, 0),
    LNNUM        NUMBER(19, 0),
    CIFNO        NUMBER(19, 0),
    ACNAME       VARCHAR2(150),
    STATUS       NUMBER(1, 0),
    TYPE         VARCHAR2(30),
    CURTYP       VARCHAR2(4),
    ORGAMT       NUMBER(15, 2),
    DRLIMT       NUMBER(15, 2),
    HOLD         NUMBER(15, 2),
    CBAL         NUMBER(15, 2),
    OTHCHG       NUMBER(13, 2),
    ACCINT       NUMBER(17, 5),
    COMACC       NUMBER(15, 5),
    PMTAMT       NUMBER(15, 2),
    FNLPMT       NUMBER(15, 2),
    BILPRN       NUMBER(15, 2),
    BILINT       NUMBER(13, 2),
    BILESC       NUMBER(13, 2),
    BILLC        NUMBER(13, 2),
    BILOC        NUMBER(13, 2),
    BILMC        NUMBER(13, 2),
    BILLCO       NUMBER(13, 2),
    YSOBAL       NUMBER(15, 2),
    DATOPN       NUMBER(7, 0),
    FRELDT       NUMBER(7, 0),
    FULLDT       NUMBER(7, 0),
    MATDT        NUMBER(7, 0),
    RATE         NUMBER(11, 9),
    LCTYPE       NUMBER(3, 0),
    ACCMLC       CHAR(1),
    TERM         NUMBER(5, 0),
    TMCODE       CHAR(1),
    FREQ         NUMBER(3, 0),
    IPFREQ       NUMBER(3, 0),
    ODIND        CHAR(1),
    PURCOD       VARCHAR2(2),
    WINDOW_ID    NUMBER(25, 0),
    COMMIT_TS    TIMESTAMP(3),
    REPLICAT_TS  TIMESTAMP(3),
    MAPPED_TS    TIMESTAMP(3),
    CHANGED_TIME TIMESTAMP(3) DEFAULT SYSTIMESTAMP,
    CALL_CDC     VARCHAR2(3),
    CONSTRAINT PK_T24_LNTNEW_ACTIVITY PRIMARY KEY (SEQUENCE_NO)
)
    TABLESPACE T24RAWOGG
    PARTITION BY RANGE (CHANGED_TIME)
    INTERVAL (NUMTODSINTERVAL(1, 'DAY'))
(
    PARTITION P1 VALUES LESS THAN (TIMESTAMP '2024-01-01 00:00:00')
        LOGGING
        NOCOMPRESS
        TABLESPACE T24RAWOGG
        PCTFREE 10
        INITRANS 5
        MAXTRANS 255
        STORAGE (
        INITIAL 1024M
        NEXT 1M
        MINEXTENTS 1
        MAXEXTENTS UNLIMITED
        BUFFER_POOL DEFAULT
        )
)
    NOCACHE
    MONITORING;

CREATE TABLE FMSB_ARR_LNMEMO
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    LINKED_APPL_ID VARCHAR2(255),
    CONSTRAINT PK_FMSB_ARR_LNMEMO PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ARR_LNMEMO_OP_TYPE
    ON FMSB_ARR_LNMEMO (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARR_LNMEMO_WINDOW_ID
    ON FMSB_ARR_LNMEMO (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARR_LNMEMO_REC_WIN_ID
    ON FMSB_ARR_LNMEMO (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARR_LNMEMO_LINKED_APPL_ID
    ON FMSB_ARR_LNMEMO (LINKED_APPL_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_BIL_LNMEMO
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    ARRANGEMENT_ID VARCHAR2(255),
    BILPRN_AMT     NUMBER(15, 2),
    BILINT_AMT     NUMBER(15, 2),
    BILLC_AMT      NUMBER(15, 2),
    CONSTRAINT PK_FMSB_BIL_LNMEMO PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_BIL_LNMEMO_OP_TYPE
    ON FMSB_BIL_LNMEMO (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_BIL_LNMEMO_WINDOW_ID
    ON FMSB_BIL_LNMEMO (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_BIL_LNMEMO_REC_WIN_ID
    ON FMSB_BIL_LNMEMO (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_BIL_LNMEMO_ARRANGEMENT_ID
    ON FMSB_BIL_LNMEMO (ARRANGEMENT_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_AIT_LNTNEW
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    ID_COMP_1      VARCHAR2(255),
    ID_COMP_2      VARCHAR2(255),
    ID_COMP_3      VARCHAR2(255),
    EFFECTIVE_RATE VARCHAR2(255),
    CONSTRAINT PK_FMSB_AIT_LNTNEW PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_AIT_LNTNEW_OP_TYPE
    ON FMSB_AIT_LNTNEW (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_AIT_LNTNEW_WINDOW_ID
    ON FMSB_AIT_LNTNEW (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_AIT_LNTNEW_REC_WIN_ID
    ON FMSB_AIT_LNTNEW (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_AIT_LNTNEW_ID_COMP_1_ID_COMP_3_DESC
    ON FMSB_AIT_LNTNEW (ID_COMP_1, ID_COMP_3 DESC)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ARC_LNTNEW
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    ARRANGEMENT    VARCHAR2(255),
    EFFECTIVE_DATE DATE,
    CONSTRAINT PK_FMSB_ARC_LNTNEW PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ARC_LNTNEW_OP_TYPE
    ON FMSB_ARC_LNTNEW (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARC_LNTNEW_ARR_EFF_DAT
    ON FMSB_ARC_LNTNEW (ARRANGEMENT, EFFECTIVE_DATE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARC_LNTNEW_ARR_EFF_DAT_DESC
    ON FMSB_ARC_LNTNEW (ARRANGEMENT, EFFECTIVE_DATE DESC)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ARR_LNTNEW
(
    RECID              VARCHAR2(255),
    WINDOW_ID          NUMBER(25),
    OP_TYPE            CHAR(1),
    COMMIT_TS          TIMESTAMP(3),
    REPLICAT_TS        TIMESTAMP(3),
    MAPPED_TS          TIMESTAMP(3),
    ARR_STATUS         VARCHAR2(50),
    LINKED_APPL_ID     VARCHAR2(255),
    ORIG_CONTRACT_DATE DATE,
    PRODUCT_STATUS     VARCHAR2(1000),
    PRODUCT            VARCHAR2(1000),
    START_DATE         VARCHAR2(8),
    CONSTRAINT PK_FMSB_ARR_LNTNEW PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ARR_LNTNEW_OP_TYPE
    ON FMSB_ARR_LNTNEW (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARR_LNTNEW_WINDOW_ID
    ON FMSB_ARR_LNTNEW (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARR_LNTNEW_REC_WIN_ID
    ON FMSB_ARR_LNTNEW (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ARR_LNTNEW_LINKED_APPL_ID
    ON FMSB_ARR_LNTNEW (LINKED_APPL_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_AAC_MAPPED
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    ID_COMP_1      VARCHAR2(255),
    ID_COMP_3      VARCHAR2(255),
    MSB_LN_PURPOSE VARCHAR2(5),
    CONSTRAINT PK_FMSB_AAC_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_AAC_MAPPED_OP_TYPE
    ON FMSB_AAC_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_AAC_MAPPED_ID_COMP_1_ID_COMP_3_DESC
    ON FMSB_AAC_MAPPED (ID_COMP_1, ID_COMP_3 DESC)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ACC_MAPPED
(
    RECID            VARCHAR2(255),
    WINDOW_ID        NUMBER(25),
    OP_TYPE          CHAR(1),
    COMMIT_TS        TIMESTAMP(3),
    REPLICAT_TS      TIMESTAMP(3),
    MAPPED_TS        TIMESTAMP(3),
    CATEGORY         VARCHAR2(255),
    CO_CODE          VARCHAR2(255),
    CURRENCY         VARCHAR2(4),
    CUSTOMER         VARCHAR2(255),
    FROM_DATE        VARCHAR2(2000),
    INPUTTER         VARCHAR2(1000),
    LIMIT_KEY        VARCHAR2(255),
    LOCKED_AMOUNT    VARCHAR2(2000),
    OPENING_DATE     DATE,
    POSTING_RESTRICT VARCHAR2(255),
    ACNAME           VARCHAR2(255),
    CONSTRAINT PK_FMSB_ACC_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ACC_MAPPED_OP_TYPE
    ON FMSB_ACC_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ACC_MAPPED_WINDOW_ID
    ON FMSB_ACC_MAPPED (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ACC_MAPPED_REC_WIN_ID
    ON FMSB_ACC_MAPPED (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_AC_MAPPED
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    DEBIT_ACCOUNT  VARCHAR2(255),
    REMARKS        CLOB,
    MSB_CHANNEL    VARCHAR2(255),
    MSB_TRANS_CODE VARCHAR2(255),
    MSB_TRANS_SEQ  VARCHAR2(255),
    CONSTRAINT PK_FMSB_AC_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_AC_MAPPED_OP_TYPE
    ON FMSB_AC_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ADL_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    MATURITY_DATE   DATE,
    RENEWAL_DATE    DATE,
    DORMANCY_STATUS VARCHAR2(255),
    CONSTRAINT PK_FMSB_ADL_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ADL_MAPPED_OP_TYPE
    ON FMSB_ADL_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ADL_MAPPED_WINDOW_ID
    ON FMSB_ADL_MAPPED (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ADL_MAPPED_REC_WIN_ID
    ON FMSB_ADL_MAPPED (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_AIT_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    ID_COMP_1       VARCHAR2(255),
    ID_COMP_2       VARCHAR2(255),
    ID_COMP_3       VARCHAR2(255),
    EFFECTIVE_RATE  VARCHAR2(255),
    FLOATING_INDEX  VARCHAR2(255),
    PERIODIC_PERIOD VARCHAR2(255),
    CONSTRAINT PK_FMSB_AIT_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_AIT_MAPPED_OP_TYPE
    ON FMSB_AIT_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ARC_MAPPED
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    ARRANGEMENT    VARCHAR2(255),
    ACTIVITY_CLASS VARCHAR2(255),
    ACTIVITY       VARCHAR2(255),
    EFFECTIVE_DATE VARCHAR2(8),
    INPUTTER       VARCHAR2(255),
    CONSTRAINT PK_FMSB_ARC_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ARC_MAPPED_OP_TYPE
    ON FMSB_ARC_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ARR_MAPPED
(
    RECID              VARCHAR2(255),
    WINDOW_ID          NUMBER(25),
    OP_TYPE            CHAR(1),
    COMMIT_TS          TIMESTAMP(3),
    REPLICAT_TS        TIMESTAMP(3),
    MAPPED_TS          TIMESTAMP(3),
    ACTIVE_PRODUCT     VARCHAR2(255),
    ARR_STATUS         VARCHAR2(255),
    CURRENCY           VARCHAR2(5),
    LINKED_APPL_ID     VARCHAR2(255),
    ORIG_CONTRACT_DATE VARCHAR2(8),
    PRODUCT_LINE       VARCHAR2(1000),
    PRODUCT_STATUS     VARCHAR2(1000),
    PRODUCT            VARCHAR2(1000),
    START_DATE         VARCHAR2(8),
    CONSTRAINT PK_FMSB_ARR_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ARR_MAPPED_OP_TYPE
    ON FMSB_ARR_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ASC_MAPPED
(
    RECID        VARCHAR2(255),
    WINDOW_ID    NUMBER(25),
    OP_TYPE      CHAR(1),
    COMMIT_TS    TIMESTAMP(3),
    REPLICAT_TS  TIMESTAMP(3),
    MAPPED_TS    TIMESTAMP(3),
    ID_COMP_1    VARCHAR2(255),
    ID_COMP_3    VARCHAR2(255),
    BILL_TYPE    VARCHAR2(2000),
    CALC_AMOUNT  VARCHAR2(2000),
    PAYMENT_FREQ VARCHAR2(2000),
    PROPERTY     VARCHAR2(2000),
    CONSTRAINT PK_FMSB_ASC_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ASC_MAPPED_OP_TYPE
    ON FMSB_ASC_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ASC_MAPPED_WINDOW_ID
    ON FMSB_ASC_MAPPED (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ASC_MAPPED_REC_WIN_ID
    ON FMSB_ASC_MAPPED (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ASC_MAPPED_ID_COMP_1_ID_COMP_3_DESC
    ON FMSB_ASC_MAPPED (ID_COMP_1, ID_COMP_3 DESC)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ATA_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    ID_COMP_1       VARCHAR2(255),
    ID_COMP_3       VARCHAR2(255),
    ACTIVITY        VARCHAR2(255),
    AMOUNT          VARCHAR2(255),
    MATURITY_DATE   DATE,
    MSB_OR_LNMAT_DT DATE,
    TERM            VARCHAR2(255),
    CONSTRAINT PK_FMSB_ATA_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ATA_MAPPED_OP_TYPE
    ON FMSB_ATA_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ATA_MAPPED_ID_COMP_1_ID_COMP_3
    ON FMSB_ATA_MAPPED (ID_COMP_1, ID_COMP_3)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_ATA_ID_COMP_1_ACTIVITY_AMOUNT
    ON FMSB_ATA_MAPPED (ID_COMP_1, ACTIVITY, TO_NUMBER(AMOUNT))
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_BIL_MAPPED
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    ARRANGEMENT_ID VARCHAR2(255),
    BILL_TYPE      VARCHAR2(1000),
    BILL_STATUS    VARCHAR2(255),
    OR_PR_AMT      VARCHAR2(500),
    OS_PR_AMT      VARCHAR2(500),
    PAY_PROPERTY   VARCHAR2(1000),
    PAYMENT_TYPE   VARCHAR2(1000),
    CONSTRAINT PK_FMSB_BIL_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_BIL_MAPPED_OP_TYPE
    ON FMSB_BIL_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_BIT_MAPPED
(
    RECID         VARCHAR2(255),
    WINDOW_ID     NUMBER(25),
    OP_TYPE       CHAR(1),
    COMMIT_TS     TIMESTAMP(3),
    REPLICAT_TS   TIMESTAMP(3),
    MAPPED_TS     TIMESTAMP(3),
    BCCY          VARCHAR2(255),
    INTEREST_RATE VARCHAR2(255),
    CONSTRAINT PK_FMSB_BIT_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_BIT_MAPPED_OP_TYPE
    ON FMSB_BIT_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_CAT_MAPPED
(
    RECID            VARCHAR2(255),
    WINDOW_ID        NUMBER(25),
    OP_TYPE          CHAR(1),
    COMMIT_TS        TIMESTAMP(3),
    REPLICAT_TS      TIMESTAMP(3),
    MAPPED_TS        TIMESTAMP(3),
    AMOUNT_FCY       VARCHAR2(255),
    AMOUNT_LCY       VARCHAR2(255),
    AUTHORISER       VARCHAR2(255),
    BOOKING_DATE     VARCHAR2(8),
    CO_CODE          VARCHAR2(255),
    CONSOL_KEY       VARCHAR2(255),
    CURRENCY         VARCHAR2(4),
    DATE_TIME        VARCHAR2(255),
    INPUTTER         VARCHAR2(255),
    NARRATIVE        VARCHAR2(255),
    PL_CATEGORY      VARCHAR2(10),
    PRODUCT_CATEGORY VARCHAR2(10),
    RECORD_STATUS    VARCHAR2(255),
    SOFT_ACCTNG_DTLS VARCHAR2(255),
    SYSTEM_ID        VARCHAR2(10),
    TRANS_REFERENCE  VARCHAR2(255),
    TRANSACTION_CODE VARCHAR2(10),
    VALUE_DATE       VARCHAR2(8),
    CONSTRAINT PK_FMSB_CAT_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_CAT_MAPPED_OP_TYPE
    ON FMSB_CAT_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_CHG_MAPPED
(
    RECID         VARCHAR2(255),
    WINDOW_ID     NUMBER(25),
    OP_TYPE       CHAR(1),
    COMMIT_TS     TIMESTAMP(3),
    REPLICAT_TS   TIMESTAMP(3),
    MAPPED_TS     TIMESTAMP(3),
    ID_COMP_1     VARCHAR2(255),
    ID_COMP_3     VARCHAR2(255),
    CHANGE_PERIOD VARCHAR2(255),
    CHANGE_DATE   VARCHAR2(8),
    CONSTRAINT PK_FMSB_CHG_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_CHG_MAPPED_OP_TYPE
    ON FMSB_CHG_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_CHG_MAPPED_ID_COMP_1_ID_COMP_3_DESC
    ON FMSB_CHG_MAPPED (ID_COMP_1, ID_COMP_3 DESC)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_ECB_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    CREDIT_MVMT     VARCHAR2(4000),
    CURR_ASSET_TYPE VARCHAR2(4000),
    DEBIT_MVMT      VARCHAR2(4000),
    OPEN_BALANCE    VARCHAR2(4000),
    CONSTRAINT PK_FMSB_ECB_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_ECB_MAPPED_OP_TYPE
    ON FMSB_ECB_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ECB_MAPPED_WINDOW_ID
    ON FMSB_ECB_MAPPED (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_ECB_MAPPED_REC_WIN_ID
    ON FMSB_ECB_MAPPED (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_FT_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    CHARGES_ACCT_NO VARCHAR2(255),
    MSB_CHANNEL     VARCHAR2(255),
    MSB_TRANS_CODE  VARCHAR2(255),
    MSB_TRANS_SEQ   VARCHAR2(255),
    PAYMENT_DETAILS CLOB,
    CONSTRAINT PK_FMSB_FT_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_FT_MAPPED_OP_TYPE
    ON FMSB_FT_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_FX_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    NOTES           VARCHAR2(4000),
    AMOUNT_BOUGHT   VARCHAR2(255),
    CURRENCY_BOUGHT VARCHAR2(5),
    AMOUNT_SOLD     VARCHAR2(255),
    CURRENCY_SOLD   VARCHAR2(5),
    CONSTRAINT PK_FMSB_FX_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_FX_MAPPED_OP_TYPE
    ON FMSB_FX_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_LMT_MAPPED
(
    RECID           VARCHAR2(255),
    WINDOW_ID       NUMBER(25),
    OP_TYPE         CHAR(1),
    COMMIT_TS       TIMESTAMP(3),
    REPLICAT_TS     TIMESTAMP(3),
    MAPPED_TS       TIMESTAMP(3),
    INTERNAL_AMOUNT VARCHAR2(255),
    CONSTRAINT PK_FMSB_LMT_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_LMT_MAPPED_OP_TYPE
    ON FMSB_LMT_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_LMT_MAPPED_WINDOW_ID
    ON FMSB_LMT_MAPPED (WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE INDEX IDX_FMSB_LMT_MAPPED_REC_WIN_ID
    ON FMSB_LMT_MAPPED (RECID, WINDOW_ID)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_REC_MAPPED
(
    RECID            VARCHAR2(255),
    WINDOW_ID        NUMBER(25),
    OP_TYPE          CHAR(1),
    COMMIT_TS        TIMESTAMP(3),
    REPLICAT_TS      TIMESTAMP(3),
    MAPPED_TS        TIMESTAMP(3),
    AMOUNT_FCY       VARCHAR2(255),
    AMOUNT_LCY       VARCHAR2(255),
    AUTHORISER       VARCHAR2(255),
    BOOKING_DATE     VARCHAR2(8),
    CO_CODE          VARCHAR2(255),
    CONSOL_KEY_TYPE  VARCHAR2(255),
    CURRENCY         VARCHAR2(4),
    DATE_TIME        VARCHAR2(255),
    DEAL_NUMBER      VARCHAR2(255),
    INPUTTER         VARCHAR2(255),
    NARRATIVE        VARCHAR2(255),
    PRODUCT_CATEGORY VARCHAR2(10),
    RECORD_STATUS    VARCHAR2(255),
    SOFT_ACCTNG_DTLS VARCHAR2(255),
    SYSTEM_ID        VARCHAR2(10),
    TRANS_REFERENCE  VARCHAR2(255),
    TRANSACTION_CODE VARCHAR2(10),
    VALUE_DATE       VARCHAR2(8),
    CONSTRAINT PK_FMSB_REC_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_REC_MAPPED_OP_TYPE
    ON FMSB_REC_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_STM_MAPPED
(
    RECID            VARCHAR2(255),
    WINDOW_ID        NUMBER(25),
    OP_TYPE          CHAR(1),
    COMMIT_TS        TIMESTAMP(3),
    REPLICAT_TS      TIMESTAMP(3),
    MAPPED_TS        TIMESTAMP(3),
    ACCOUNT_NUMBER   VARCHAR2(255),
    AMOUNT_FCY       VARCHAR2(255),
    AMOUNT_LCY       VARCHAR2(255),
    BOOKING_DATE     VARCHAR2(8),
    CRF_TYPE         VARCHAR2(255),
    CURRENCY         VARCHAR2(4),
    DATE_TIME        VARCHAR2(255),
    INPUTTER         VARCHAR2(255),
    NARRATIVE_1      VARCHAR2(255),
    NARRATIVE        VARCHAR2(1000),
    OUR_REFERENCE    VARCHAR2(255),
    PRODUCT_CATEGORY VARCHAR2(10),
    RECORD_STATUS    VARCHAR2(255),
    REVERSAL_MARKER  VARCHAR2(255),
    SYSTEM_ID        VARCHAR2(10),
    TRANS_REFERENCE  VARCHAR2(255),
    TRANSACTION_CODE VARCHAR2(10),
    VALUE_DATE       VARCHAR2(8),
    CONSTRAINT PK_FMSB_STM_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_STM_MAPPED_OP_TYPE
    ON FMSB_STM_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE FMSB_TR_MAPPED
(
    RECID       VARCHAR2(255),
    WINDOW_ID   NUMBER(25),
    OP_TYPE     CHAR(1),
    COMMIT_TS   TIMESTAMP(3),
    REPLICAT_TS TIMESTAMP(3),
    MAPPED_TS   TIMESTAMP(3),
    NARRATIVE_1 VARCHAR2(255),
    NARRATIVE_2 VARCHAR2(255),
    CONSTRAINT PK_FMSB_TR_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_FMSB_TR_MAPPED_OP_TYPE
    ON FMSB_TR_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE F_DAT_MAPPED
(
    RECID       VARCHAR2(255),
    WINDOW_ID   NUMBER(25),
    OP_TYPE     CHAR(1),
    COMMIT_TS   TIMESTAMP(3),
    REPLICAT_TS TIMESTAMP(3),
    MAPPED_TS   TIMESTAMP(3),
    TODAY       VARCHAR2(8),
    CONSTRAINT PK_F_DAT_MAPPED PRIMARY KEY (RECID)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_F_DAT_MAPPED_OP_TYPE
    ON F_DAT_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE F_POR_MAPPED
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    STATUS_CODE    VARCHAR2(255),
    OUTPUT_CHANNEL VARCHAR2(255),
    CONSTRAINT PK_F_POR_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_F_POR_MAPPED_OP_TYPE
    ON F_POR_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE F_PST_MAPPED
(
    RECID            VARCHAR2(255),
    WINDOW_ID        NUMBER(25),
    OP_TYPE          CHAR(1),
    COMMIT_TS        TIMESTAMP(3),
    REPLICAT_TS      TIMESTAMP(3),
    MAPPED_TS        TIMESTAMP(3),
    RESTRICTION_TYPE VARCHAR2(255),
    CONSTRAINT PK_F_PST_MAPPED PRIMARY KEY (RECID)
)
    INMEMORY MEMCOMPRESS FOR QUERY LOW
    PRIORITY CRITICAL
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_F_PST_MAPPED_OP_TYPE
    ON F_PST_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE F_SUP_MAPPED
(
    RECID          VARCHAR2(255),
    WINDOW_ID      NUMBER(25),
    OP_TYPE        CHAR(1),
    COMMIT_TS      TIMESTAMP(3),
    REPLICAT_TS    TIMESTAMP(3),
    MAPPED_TS      TIMESTAMP(3),
    LOC_FIELD_NAME CLOB,
    CONSTRAINT PK_F_SUP_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_F_SUP_MAPPED_OP_TYPE
    ON F_SUP_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE TABLE F_TMV_MAPPED
(
    RECID              VARCHAR2(255),
    WINDOW_ID          NUMBER(25),
    OP_TYPE            CHAR(1),
    COMMIT_TS          TIMESTAMP(3),
    REPLICAT_TS        TIMESTAMP(3),
    MAPPED_TS          TIMESTAMP(3),
    ORIGINAL_FT_NUMBER VARCHAR2(255),
    RESERVED1          VARCHAR2(255),
    RESERVED2          VARCHAR2(255),
    PAYMENT_DIRECTION  VARCHAR2(3),
    CONSTRAINT PK_F_TMV_MAPPED PRIMARY KEY (RECID)
)
    TABLESPACE T24RAWOGG;

CREATE INDEX IDX_F_TMV_MAPPED_OP_TYPE
    ON F_TMV_MAPPED (OP_TYPE)
    TABLESPACE T24RAWOGG_IDX;

CREATE OR REPLACE VIEW V_FMSB_ARR_LNMEMO AS
SELECT *
FROM FMSB_ARR_LNMEMO
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_BIL_LNMEMO AS
SELECT *
FROM FMSB_BIL_LNMEMO
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_AIT_LNTNEW AS
SELECT *
FROM FMSB_AIT_LNTNEW
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_ARC_LNTNEW AS
SELECT *
FROM FMSB_ARC_LNTNEW
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_ARR_LNTNEW AS
SELECT *
FROM FMSB_ARR_LNTNEW
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_AAC_MAPPED AS
SELECT *
FROM FMSB_AAC_MAPPED
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_ACC_MAPPED AS
SELECT *
FROM FMSB_ACC_MAPPED
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_ASC_MAPPED AS
SELECT *
FROM FMSB_ASC_MAPPED
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_ATA_MAPPED AS
SELECT *
FROM FMSB_ATA_MAPPED
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_ECB_MAPPED AS
SELECT *
FROM FMSB_ECB_MAPPED
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE VIEW V_FMSB_LMT_MAPPED AS
SELECT *
FROM FMSB_LMT_MAPPED
WHERE OP_TYPE <> 'D';

CREATE OR REPLACE TYPE T_WINDOW_ID_ARRAY AS TABLE OF NUMBER(25);

CREATE OR REPLACE PACKAGE T24RAWOGG.T24_UTILS_PKG IS

    FUNCTION GET_LAST_VAL_FUNC(
        P_INPUT IN VARCHAR2
    ) RETURN VARCHAR2;

    FUNCTION GET_STR_VAL_BY_POS_FUNC(
        P_INPUT IN VARCHAR2,
        P_POS IN VARCHAR2
    ) RETURN VARCHAR2;

    FUNCTION GET_NUM_VAL_BY_POS_FUNC(
        P_INPUT IN VARCHAR2,
        P_POS IN VARCHAR2
    ) RETURN NUMBER;

    FUNCTION MEMO_EXCEED_FUNC(
        P_INPUT IN NUMBER,
        P_PRECISION IN NUMBER,
        P_SCALE IN NUMBER
    ) RETURN NUMBER;

END T24_UTILS_PKG;

CREATE OR REPLACE PACKAGE BODY T24RAWOGG.T24_UTILS_PKG IS

    FUNCTION GET_LAST_VAL_FUNC(
        P_INPUT IN VARCHAR2
    ) RETURN VARCHAR2 IS
    BEGIN
        RETURN SUBSTR(P_INPUT, INSTR(P_INPUT, ':', -1) + 1);
    END GET_LAST_VAL_FUNC;

    FUNCTION GET_STR_VAL_BY_POS_FUNC(
        P_INPUT IN VARCHAR2,
        P_POS IN VARCHAR2
    ) RETURN VARCHAR2 IS
        V_IDX    PLS_INTEGER := INSTR(P_INPUT, P_POS);
        V_START  PLS_INTEGER;
        V_END    PLS_INTEGER;
        V_RESULT VARCHAR2(255);
    BEGIN
        IF V_IDX = 0 THEN
            RETURN NULL;
        END IF;

        V_START := V_IDX + LENGTH(P_POS);
        V_END := INSTR(P_INPUT, '#', V_START);

        IF V_END = 0 THEN
            V_RESULT := SUBSTR(P_INPUT, V_START);
        ELSE
            V_RESULT := SUBSTR(P_INPUT, V_START, V_END - V_START);
        END IF;

        RETURN V_RESULT;
    END GET_STR_VAL_BY_POS_FUNC;

    FUNCTION GET_NUM_VAL_BY_POS_FUNC(
        P_INPUT IN VARCHAR2,
        P_POS IN VARCHAR2
    ) RETURN NUMBER IS
        V_IDX    PLS_INTEGER := INSTR(P_INPUT, P_POS);
        V_START  PLS_INTEGER;
        V_END    PLS_INTEGER;
        V_RESULT VARCHAR2(20);
    BEGIN
        IF V_IDX = 0 THEN
            RETURN 0;
        END IF;

        V_START := V_IDX + LENGTH(P_POS);
        V_END := INSTR(P_INPUT, '#', V_START);

        IF V_END = 0 THEN
            V_RESULT := SUBSTR(P_INPUT, V_START);
        ELSE
            V_RESULT := SUBSTR(P_INPUT, V_START, V_END - V_START);
        END IF;

        RETURN NVL(TO_NUMBER(V_RESULT), 0);
    END GET_NUM_VAL_BY_POS_FUNC;

    FUNCTION MEMO_EXCEED_FUNC(
        P_INPUT IN NUMBER,
        P_PRECISION IN NUMBER,
        P_SCALE IN NUMBER
    ) RETURN NUMBER IS
    BEGIN
        IF ABS(P_INPUT) < POWER(10, P_PRECISION - P_SCALE) THEN
            RETURN P_INPUT;
        ELSE
            RETURN 0;
        END IF;
    END MEMO_EXCEED_FUNC;

END T24_UTILS_PKG;

CREATE OR REPLACE PACKAGE T24RAWOGG.T IS

    FUNCTION BILPRN(
        P_PAY_PROPERTY IN VARCHAR2,
        P_BILL_TYPE    IN VARCHAR2,
        P_OS_PR_AMT    IN VARCHAR2
    ) RETURN NUMBER;

    FUNCTION BILINT(
        P_PAY_PROPERTY IN VARCHAR2,
        P_BILL_TYPE    IN VARCHAR2,
        P_OS_PR_AMT    IN VARCHAR2
    ) RETURN NUMBER;

    FUNCTION BILLC(
        P_PAY_PROPERTY IN VARCHAR2,
        P_PAYMENT_TYPE IN VARCHAR2,
        P_OS_PR_AMT IN VARCHAR2,
        P_OR_PR_AMT IN VARCHAR2
    ) RETURN NUMBER;

END T;

CREATE OR REPLACE PACKAGE BODY T24RAWOGG.T IS

    -- BILPRN
    FUNCTION BILPRN(
        P_PAY_PROPERTY IN VARCHAR2,
        P_BILL_TYPE    IN VARCHAR2,
        P_OS_PR_AMT    IN VARCHAR2
    ) RETURN NUMBER IS
        V_START        PLS_INTEGER := 2;
        V_LEN          PLS_INTEGER := LENGTH(P_PAY_PROPERTY);
        V_COLON_IDX    PLS_INTEGER;
        V_HASH_IDX     PLS_INTEGER;
        V_POS          VARCHAR2(8);
        V_PAY_PROPERTY VARCHAR2(50);
        V_BILL_TYPE    VARCHAR2(50);
        V_OS_PR_AMT    NUMBER;
        V_BILPRN       NUMBER := 0;
    BEGIN
        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_PAY_PROPERTY, ':', V_START) + 1;
            V_HASH_IDX := INSTR(P_PAY_PROPERTY, '#', V_COLON_IDX);

            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS := SUBSTR(P_PAY_PROPERTY, V_START, V_COLON_IDX - V_START);

            V_PAY_PROPERTY := SUBSTR(P_PAY_PROPERTY, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);
            V_BILL_TYPE := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_BILL_TYPE, SUBSTR(V_POS, 1, INSTR(V_POS, 's') - 1) || ':');
            V_OS_PR_AMT := T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_OS_PR_AMT, V_POS);

            IF V_PAY_PROPERTY = 'ACCOUNT'
            AND V_BILL_TYPE IN ('INSTALLMENT', 'INVESTORBILL', 'PAYMENT')
            AND V_OS_PR_AMT > 0
            THEN
                V_BILPRN := V_BILPRN + V_OS_PR_AMT;
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN V_BILPRN;
    END BILPRN;

    -- BILINT
    FUNCTION BILINT(
        P_PAY_PROPERTY IN VARCHAR2,
        P_BILL_TYPE    IN VARCHAR2,
        P_OS_PR_AMT    IN VARCHAR2
    ) RETURN NUMBER IS
        V_START        PLS_INTEGER := 2;
        V_LEN          PLS_INTEGER := LENGTH(P_PAY_PROPERTY);
        V_COLON_IDX    PLS_INTEGER;
        V_HASH_IDX     PLS_INTEGER;
        V_POS          VARCHAR2(8);
        V_PAY_PROPERTY VARCHAR2(50);
        V_BILL_TYPE    VARCHAR2(50);
        V_OS_PR_AMT    NUMBER;
        V_BILINT       NUMBER := 0;
    BEGIN
        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_PAY_PROPERTY, ':', V_START) + 1;
            V_HASH_IDX := INSTR(P_PAY_PROPERTY, '#', V_COLON_IDX);

            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS := SUBSTR(P_PAY_PROPERTY, V_START, V_COLON_IDX - V_START);

            V_PAY_PROPERTY := SUBSTR(P_PAY_PROPERTY, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);
            V_BILL_TYPE := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_BILL_TYPE, SUBSTR(V_POS, 1, INSTR(V_POS, 's') - 1) || ':');
            V_OS_PR_AMT := T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_OS_PR_AMT, V_POS);

            IF V_PAY_PROPERTY IN ('LOANINTEREST', 'LNINTPREBUY', 'INVESTORINT', 'RISKINTEREST')
            AND V_BILL_TYPE IN ('INSTALLMENT', 'INVESTORBILL', 'PAYMENT')
            AND V_OS_PR_AMT > 0
            THEN
                V_BILINT := V_BILINT + V_OS_PR_AMT;
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN V_BILINT;
    END BILINT;

    -- BILLC
    FUNCTION BILLC(
        P_PAY_PROPERTY IN VARCHAR2,
        P_PAYMENT_TYPE IN VARCHAR2,
        P_OS_PR_AMT IN VARCHAR2,
        P_OR_PR_AMT IN VARCHAR2
    ) RETURN NUMBER IS
        V_START        PLS_INTEGER := 2;
        V_LEN          PLS_INTEGER := LENGTH(P_PAY_PROPERTY);
        V_COLON_IDX    PLS_INTEGER;
        V_HASH_IDX     PLS_INTEGER;
        V_POS          VARCHAR2(8);
        V_PAY_PROPERTY VARCHAR2(50);
        V_PAYMENT_TYPE VARCHAR2(50);
        V_OS_PR_AMT    NUMBER;
        V_OR_PR_AMT    NUMBER;
        V_BILLC        NUMBER := 0;
    BEGIN
        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_PAY_PROPERTY, ':', V_START) + 1;
            V_HASH_IDX := INSTR(P_PAY_PROPERTY, '#', V_COLON_IDX);

            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS := SUBSTR(P_PAY_PROPERTY, V_START, V_COLON_IDX - V_START);

            V_PAY_PROPERTY := SUBSTR(P_PAY_PROPERTY, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);
            V_PAYMENT_TYPE := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_PAYMENT_TYPE, SUBSTR(V_POS, 1, INSTR(V_POS, 's') - 1) || ':');
            V_OS_PR_AMT := T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_OS_PR_AMT, V_POS);
            V_OR_PR_AMT := T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_OR_PR_AMT, V_POS);

            IF V_PAY_PROPERTY IN (
                'LNPRINPEN', 'INVESTORPENINT', 'RISKPRINPEN',
                'SYNPRINPEN', 'LNINTPEN', 'RISKINTPEN', 'SYNINTPEN'
            )
            AND V_PAYMENT_TYPE IN ('CURRENT', 'PENALTY')
            AND V_OS_PR_AMT > 0
            THEN
                V_BILLC := V_BILLC + V_OR_PR_AMT;
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN V_BILLC;
    END BILLC;
END T;

CREATE OR REPLACE PACKAGE T24RAWOGG.T24_LNMEMO_ACTIVITY_PKG IS

    FUNCTION CALC_CBAL_VAL_FUNC(
        P_CURR_ASSET_TYPE IN VARCHAR2,
        P_OPEN_BALANCE    IN VARCHAR2,
        P_CREDIT_MVMT     IN VARCHAR2,
        P_DEBIT_MVMT      IN VARCHAR2
    ) RETURN NUMBER;

    FUNCTION CALC_HOLD_VAL_FUNC(
        P_FROM_DATE     IN VARCHAR2,
        P_TODAY         IN VARCHAR2,
        P_LOCKED_AMOUNT IN VARCHAR2
    ) RETURN NUMBER;

    FUNCTION CALC_ACCINT_VAL_FUNC(
        P_CURR_ASSET_TYPE IN VARCHAR2,
        P_OPEN_BALANCE    IN VARCHAR2,
        P_CREDIT_MVMT     IN VARCHAR2,
        P_DEBIT_MVMT      IN VARCHAR2
    ) RETURN NUMBER;

    PROCEDURE GEN_FROM_ACC_PROC;
    PROCEDURE GEN_FROM_ARR_PROC;
    PROCEDURE GEN_FROM_BIL_PROC;
    PROCEDURE GEN_FROM_ECB_PROC;

END T24_LNMEMO_ACTIVITY_PKG;

CREATE OR REPLACE PACKAGE BODY T24RAWOGG.T24_LNMEMO_ACTIVITY_PKG IS

    ---------------------------------------------------------------------------
    -- CALC_CBAL_VAL_FUNC
    ---------------------------------------------------------------------------
    FUNCTION CALC_CBAL_VAL_FUNC(
        P_CURR_ASSET_TYPE IN VARCHAR2,
        P_OPEN_BALANCE    IN VARCHAR2,
        P_CREDIT_MVMT     IN VARCHAR2,
        P_DEBIT_MVMT      IN VARCHAR2
    ) RETURN NUMBER IS
        V_START           PLS_INTEGER := 1;
        V_LEN             PLS_INTEGER := LENGTH(P_CURR_ASSET_TYPE);
        V_COLON_IDX       PLS_INTEGER;
        V_HASH_IDX        PLS_INTEGER;
        V_POS             VARCHAR2(6);
        V_CURR_ASSET_TYPE VARCHAR2(255);
        V_CBAL            NUMBER := 0;
    BEGIN
        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_CURR_ASSET_TYPE, ':', V_START) + 1;
            V_HASH_IDX  := INSTR(P_CURR_ASSET_TYPE, '#', V_COLON_IDX);
            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS             := SUBSTR(P_CURR_ASSET_TYPE, V_START, V_COLON_IDX - V_START);
            V_CURR_ASSET_TYPE := SUBSTR(P_CURR_ASSET_TYPE, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);

            IF V_CURR_ASSET_TYPE IN (
                'CURACCOUNT', 'DUEACCOUNT', 'DELACCOUNT',
                'CURACCOUNTINF', 'DUEACCOUNTINF', 'DELACCOUNTINF'
            ) THEN
                V_CBAL := V_CBAL
                       + T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_OPEN_BALANCE, V_POS)
                       + T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_CREDIT_MVMT, V_POS)
                       + T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_DEBIT_MVMT, V_POS);
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN ABS(V_CBAL);
    END CALC_CBAL_VAL_FUNC;

    ---------------------------------------------------------------------------
    -- CALC_HOLD_VAL_FUNC
    ---------------------------------------------------------------------------
    FUNCTION CALC_HOLD_VAL_FUNC(
        P_FROM_DATE     IN VARCHAR2,
        P_TODAY         IN VARCHAR2,
        P_LOCKED_AMOUNT IN VARCHAR2
    ) RETURN NUMBER IS
        V_HOLD          NUMBER;
        V_PAST          NUMBER;
        V_START         PLS_INTEGER := 1;
        V_LEN           PLS_INTEGER := LENGTH(P_FROM_DATE);
        V_COLON_IDX     PLS_INTEGER;
        V_HASH_IDX      PLS_INTEGER;
        V_POS           VARCHAR2(6);
        V_FROM_DATE     VARCHAR2(8);
        V_LOCKED_AMOUNT NUMBER;
    BEGIN
        IF P_LOCKED_AMOUNT IS NULL THEN
            RETURN 0;
        END IF;

        V_HOLD := TO_NUMBER(T24_UTILS_PKG.GET_LAST_VAL_FUNC(P_LOCKED_AMOUNT));

        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_FROM_DATE, ':', V_START) + 1;
            V_HASH_IDX  := INSTR(P_FROM_DATE, '#', V_COLON_IDX);
            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS           := SUBSTR(P_FROM_DATE, V_START, V_COLON_IDX - V_START);
            V_FROM_DATE     := SUBSTR(P_FROM_DATE, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);
            V_LOCKED_AMOUNT := T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_LOCKED_AMOUNT, V_POS);

            IF V_FROM_DATE > P_TODAY THEN
                V_HOLD := GREATEST(V_HOLD, V_LOCKED_AMOUNT);
            ELSE
                V_PAST := V_LOCKED_AMOUNT;
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN GREATEST(V_HOLD, NVL(V_PAST, V_HOLD));
    END CALC_HOLD_VAL_FUNC;

    ---------------------------------------------------------------------------
    -- CALC_ACCINT_VAL_FUNC
    ---------------------------------------------------------------------------
    FUNCTION CALC_ACCINT_VAL_FUNC(
        P_CURR_ASSET_TYPE IN VARCHAR2,
        P_OPEN_BALANCE    IN VARCHAR2,
        P_CREDIT_MVMT     IN VARCHAR2,
        P_DEBIT_MVMT      IN VARCHAR2
    ) RETURN NUMBER IS
        V_START           PLS_INTEGER := 1;
        V_LEN             PLS_INTEGER := LENGTH(P_CURR_ASSET_TYPE);
        V_COLON_IDX       PLS_INTEGER;
        V_HASH_IDX        PLS_INTEGER;
        V_POS             VARCHAR2(6);
        V_CURR_ASSET_TYPE VARCHAR2(255);
        V_ACCINT          NUMBER := 0;
    BEGIN
        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_CURR_ASSET_TYPE, ':', V_START) + 1;
            V_HASH_IDX  := INSTR(P_CURR_ASSET_TYPE, '#', V_COLON_IDX);
            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS             := SUBSTR(P_CURR_ASSET_TYPE, V_START, V_COLON_IDX - V_START);
            V_CURR_ASSET_TYPE := SUBSTR(P_CURR_ASSET_TYPE, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);

            IF V_CURR_ASSET_TYPE IN (
                'ACCLOANINTEREST', 'ACCLNINTPREBUY', 'ACCINVESTORINT', 'ACCRISKINTEREST', 'ACCLOANINTERESTINF',
                'DUELOANINTEREST', 'DUELNINTPREBUY', 'DUEINVESTORINT', 'DUERISKINTEREST', 'DUELOANINTERESTINF',
                'DELLOANINTEREST', 'DELLNINTPREBUY', 'DELINVESTORINT', 'DELRISKINTEREST', 'DELLOANINTERESTINF'
            ) THEN
                V_ACCINT := V_ACCINT
                         + T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_OPEN_BALANCE, V_POS)
                         + T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_CREDIT_MVMT, V_POS)
                         + T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_DEBIT_MVMT, V_POS);
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN ABS(V_ACCINT);
    END CALC_ACCINT_VAL_FUNC;

    ---------------------------------------------------------------------------
    -- GEN_FROM_ACC_PROC
    ---------------------------------------------------------------------------
    PROCEDURE GEN_FROM_ACC_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNMEMO_ACTIVITY_ACC CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_ACC_MAPPED ACC
            WHERE ACC.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= ACC.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNMEMO_ACTIVITY (
                ACCTNO,
                CURTYP,
                CBAL,
                HOLD,
                DRLIMT,
                ACCINT,
                COMACC,
                OTHCHG,
                BILPRN,
                BILINT,
                BILESC,
                BILLC,
                BILOC,
                BILMC,
                WINDOW_ID,
                COMMIT_TS,
                REPLICAT_TS,
                MAPPED_TS,
                CALL_CDC
            )
            WITH PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */
                    ACC.RECID            AS ACCTNO,
                    ARR.RECID            AS ARR_RECID,
                    ACC.CURRENCY         AS CURTYP,
                    ECB.CURR_ASSET_TYPE  AS CURR_ASSET_TYPE,
                    ECB.OPEN_BALANCE     AS OPEN_BALANCE,
                    ECB.CREDIT_MVMT      AS CREDIT_MVMT,
                    ECB.DEBIT_MVMT       AS DEBIT_MVMT,
                    ACC.FROM_DATE        AS FROM_DATE,
                    ACC.LOCKED_AMOUNT    AS LOCKED_AMOUNT,
                    LMT.INTERNAL_AMOUNT  AS DRLIMT,
                    ACC.WINDOW_ID        AS WINDOW_ID,
                    ACC.COMMIT_TS        AS COMMIT_TS,
                    ACC.REPLICAT_TS      AS REPLICAT_TS,
                    ACC.MAPPED_TS        AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                INNER JOIN V_FMSB_ACC_MAPPED ACC ON ACC.WINDOW_ID      = V.COLUMN_VALUE
                INNER JOIN V_FMSB_ECB_MAPPED ECB ON ECB.RECID          = ACC.RECID
                INNER JOIN V_FMSB_ARR_LNMEMO ARR ON ARR.LINKED_APPL_ID = ACC.RECID
                LEFT  JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID          = ACC.LIMIT_KEY
            ),
            AGGREGATED AS (
                SELECT
                    BIL.ARRANGEMENT_ID,
                    SUM(BILPRN_AMT) AS BILPRN,
                    SUM(BILINT_AMT) AS BILINT,
                    SUM(BILLC_AMT)  AS BILLC
                FROM V_FMSB_BIL_LNMEMO BIL
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = BIL.ARRANGEMENT_ID
                )
                GROUP BY BIL.ARRANGEMENT_ID
            )
            SELECT 
                TO_NUMBER(PRE.ACCTNO), -- ACCTNO
                PRE.CURTYP, -- CURTYP
                CALC_CBAL_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- CBAL
                CALC_HOLD_VAL_FUNC(PRE.FROM_DATE, V_TODAY, PRE.LOCKED_AMOUNT), -- HOLD
                NVL(TO_NUMBER(PRE.DRLIMT), 0), -- DRLIMT
                CALC_ACCINT_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- ACCINT
                0, -- COMACC
                0, -- OTHCHG
                AGG.BILPRN, -- BILPRN
                AGG.BILINT, -- BILINT
                0, -- BILESC
                AGG.BILLC, -- BILLC
                0, -- BILOC
                0, -- BILMC
                PRE.WINDOW_ID, -- WINDOW_ID
                PRE.COMMIT_TS, -- COMMIT_TS
                PRE.REPLICAT_TS, -- REPLICAT_TS
                PRE.MAPPED_TS, -- MAPPED_TS
                'ACC' -- CALL_CDC
            FROM PRECOMPUTED PRE
            LEFT JOIN AGGREGATED AGG ON AGG.ARRANGEMENT_ID = PRE.ARR_RECID;

            DELETE FROM T24_LNMEMO_ACTIVITY_ACC
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_ACC_PROC;

    ---------------------------------------------------------------------------
    -- GEN_FROM_ARR_PROC
    ---------------------------------------------------------------------------
    PROCEDURE GEN_FROM_ARR_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNMEMO_ACTIVITY_ARR CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_ARR_LNMEMO ARR
            WHERE ARR.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= ARR.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNMEMO_ACTIVITY (
                ACCTNO,
                CURTYP,
                CBAL,
                HOLD,
                DRLIMT,
                ACCINT,
                COMACC,
                OTHCHG,
                BILPRN,
                BILINT,
                BILESC,
                BILLC,
                BILOC,
                BILMC,
                WINDOW_ID,
                COMMIT_TS,
                REPLICAT_TS,
                MAPPED_TS,
                CALL_CDC
            )
            WITH PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */
                    ARR.LINKED_APPL_ID  AS ACCTNO,
                    ARR.RECID           AS ARR_RECID,
                    ACC.CURRENCY        AS CURTYP,
                    ECB.CURR_ASSET_TYPE AS CURR_ASSET_TYPE,
                    ECB.OPEN_BALANCE    AS OPEN_BALANCE,
                    ECB.CREDIT_MVMT     AS CREDIT_MVMT,
                    ECB.DEBIT_MVMT      AS DEBIT_MVMT,
                    ACC.FROM_DATE       AS FROM_DATE,
                    ACC.LOCKED_AMOUNT   AS LOCKED_AMOUNT,
                    LMT.INTERNAL_AMOUNT AS DRLIMT,
                    ARR.WINDOW_ID       AS WINDOW_ID,
                    ARR.COMMIT_TS       AS COMMIT_TS,
                    ARR.REPLICAT_TS     AS REPLICAT_TS,
                    ARR.MAPPED_TS       AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                INNER JOIN V_FMSB_ARR_LNMEMO ARR ON ARR.WINDOW_ID = V.COLUMN_VALUE
                INNER JOIN V_FMSB_ACC_MAPPED ACC ON ACC.RECID     = ARR.LINKED_APPL_ID
                INNER JOIN V_FMSB_ECB_MAPPED ECB ON ECB.RECID     = ARR.LINKED_APPL_ID
                LEFT  JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID     = ACC.LIMIT_KEY
            ),
            AGGREGATED AS (
                SELECT
                    BIL.ARRANGEMENT_ID,
                    SUM(BILPRN_AMT) AS BILPRN,
                    SUM(BILINT_AMT) AS BILINT,
                    SUM(BILLC_AMT)  AS BILLC
                FROM V_FMSB_BIL_LNMEMO BIL
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = BIL.ARRANGEMENT_ID
                )
                GROUP BY BIL.ARRANGEMENT_ID
            )
            SELECT 
                TO_NUMBER(PRE.ACCTNO), -- ACCTNO
                PRE.CURTYP, -- CURTYP
                CALC_CBAL_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- CBAL
                CALC_HOLD_VAL_FUNC(PRE.FROM_DATE, V_TODAY, PRE.LOCKED_AMOUNT), -- HOLD
                NVL(TO_NUMBER(PRE.DRLIMT), 0), -- DRLIMT
                CALC_ACCINT_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- ACCINT
                0, -- COMACC
                0, -- OTHCHG
                AGG.BILPRN, -- BILPRN
                AGG.BILINT, -- BILINT
                0, -- BILESC
                AGG.BILLC, -- BILLC
                0, -- BILOC
                0, -- BILMC
                PRE.WINDOW_ID, -- WINDOW_ID
                PRE.COMMIT_TS, -- COMMIT_TS
                PRE.REPLICAT_TS, -- REPLICAT_TS
                PRE.MAPPED_TS, -- MAPPED_TS
                'ARR' -- CALL_CDC
            FROM PRECOMPUTED PRE
            LEFT JOIN AGGREGATED AGG ON AGG.ARRANGEMENT_ID = PRE.ARR_RECID;

            DELETE FROM T24_LNMEMO_ACTIVITY_ARR
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_ARR_PROC;

    ---------------------------------------------------------------------------
    -- GEN_FROM_BIL_PROC
    ---------------------------------------------------------------------------
    PROCEDURE GEN_FROM_BIL_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNMEMO_ACTIVITY_BIL CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_BIL_LNMEMO BIL
            WHERE BIL.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= BIL.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNMEMO_ACTIVITY (
                ACCTNO,
                CURTYP,
                CBAL,
                HOLD,
                DRLIMT,
                ACCINT,
                COMACC,
                OTHCHG,
                BILPRN,
                BILINT,
                BILESC,
                BILLC,
                BILOC,
                BILMC,
                WINDOW_ID,
                COMMIT_TS,
                REPLICAT_TS,
                MAPPED_TS,
                CALL_CDC
            )
            WITH PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */
                    ARR.LINKED_APPL_ID  AS ACCTNO,
                    ARR.RECID           AS ARR_RECID,
                    ACC.CURRENCY        AS CURTYP,
                    ECB.CURR_ASSET_TYPE AS CURR_ASSET_TYPE,
                    ECB.OPEN_BALANCE    AS OPEN_BALANCE,
                    ECB.CREDIT_MVMT     AS CREDIT_MVMT,
                    ECB.DEBIT_MVMT      AS DEBIT_MVMT,
                    ACC.FROM_DATE       AS FROM_DATE,
                    ACC.LOCKED_AMOUNT   AS LOCKED_AMOUNT,
                    LMT.INTERNAL_AMOUNT AS DRLIMT,
                    BIL.WINDOW_ID       AS WINDOW_ID,
                    BIL.COMMIT_TS       AS COMMIT_TS,
                    BIL.REPLICAT_TS     AS REPLICAT_TS,
                    BIL.MAPPED_TS       AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                INNER JOIN V_FMSB_BIL_LNMEMO BIL ON BIL.WINDOW_ID = V.COLUMN_VALUE
                INNER JOIN V_FMSB_ARR_LNMEMO ARR ON ARR.RECID     = BIL.ARRANGEMENT_ID
                INNER JOIN V_FMSB_ACC_MAPPED ACC ON ACC.RECID     = ARR.LINKED_APPL_ID
                INNER JOIN V_FMSB_ECB_MAPPED ECB ON ECB.RECID     = ACC.RECID
                LEFT  JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID     = ACC.LIMIT_KEY
            ),
            AGGREGATED AS (
                SELECT
                    BIL.ARRANGEMENT_ID,
                    SUM(BILPRN_AMT) AS BILPRN,
                    SUM(BILINT_AMT) AS BILINT,
                    SUM(BILLC_AMT)  AS BILLC
                FROM V_FMSB_BIL_LNMEMO BIL
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = BIL.ARRANGEMENT_ID
                )
                GROUP BY BIL.ARRANGEMENT_ID
            )
            SELECT
                TO_NUMBER(PRE.ACCTNO), -- ACCTNO
                PRE.CURTYP, -- CURTYP
                CALC_CBAL_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- CBAL
                CALC_HOLD_VAL_FUNC(PRE.FROM_DATE, V_TODAY, PRE.LOCKED_AMOUNT), -- HOLD
                NVL(TO_NUMBER(PRE.DRLIMT), 0), -- DRLIMT
                CALC_ACCINT_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- ACCINT
                0, -- COMACC
                0, -- OTHCHG
                AGG.BILPRN, -- BILPRN
                AGG.BILINT, -- BILINT
                0, -- BILESC
                AGG.BILLC, -- BILLC
                0, -- BILOC
                0, -- BILMC
                PRE.WINDOW_ID, -- WINDOW_ID
                PRE.COMMIT_TS, -- COMMIT_TS
                PRE.REPLICAT_TS, -- REPLICAT_TS
                PRE.MAPPED_TS, -- MAPPED_TS
                'BIL' -- CALL_CDC
            FROM PRECOMPUTED PRE
            LEFT JOIN AGGREGATED AGG ON AGG.ARRANGEMENT_ID = PRE.ARR_RECID;

            DELETE FROM T24_LNMEMO_ACTIVITY_BIL
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_BIL_PROC;

    ---------------------------------------------------------------------------
    -- GEN_FROM_ECB_PROC
    ---------------------------------------------------------------------------
    PROCEDURE GEN_FROM_ECB_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNMEMO_ACTIVITY_ECB CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_ECB_MAPPED ECB
            WHERE ECB.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= ECB.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNMEMO_ACTIVITY (
                ACCTNO,
                CURTYP,
                CBAL,
                HOLD,
                DRLIMT,
                ACCINT,
                COMACC,
                OTHCHG,
                BILPRN,
                BILINT,
                BILESC,
                BILLC,
                BILOC,
                BILMC,
                WINDOW_ID,
                COMMIT_TS,
                REPLICAT_TS,
                MAPPED_TS,
                CALL_CDC
            )
            WITH PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */
                    ECB.RECID            AS ACCTNO,
                    ARR.RECID            AS ARR_RECID,
                    ACC.CURRENCY         AS CURTYP,
                    ECB.CURR_ASSET_TYPE  AS CURR_ASSET_TYPE,
                    ECB.OPEN_BALANCE     AS OPEN_BALANCE,
                    ECB.CREDIT_MVMT      AS CREDIT_MVMT,
                    ECB.DEBIT_MVMT       AS DEBIT_MVMT,
                    ACC.FROM_DATE        AS FROM_DATE,
                    ACC.LOCKED_AMOUNT    AS LOCKED_AMOUNT,
                    LMT.INTERNAL_AMOUNT  AS DRLIMT,
                    ECB.WINDOW_ID        AS WINDOW_ID,
                    ECB.COMMIT_TS        AS COMMIT_TS,
                    ECB.REPLICAT_TS      AS REPLICAT_TS,
                    ECB.MAPPED_TS        AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                INNER JOIN V_FMSB_ECB_MAPPED ECB ON ECB.WINDOW_ID      = V.COLUMN_VALUE
                INNER JOIN V_FMSB_ACC_MAPPED ACC ON ACC.RECID          = ECB.RECID
                INNER JOIN V_FMSB_ARR_LNMEMO ARR ON ARR.LINKED_APPL_ID = ECB.RECID
                LEFT  JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID          = ACC.LIMIT_KEY
            ),
            AGGREGATED AS (
                SELECT
                    BIL.ARRANGEMENT_ID,
                    SUM(BILPRN_AMT) AS BILPRN,
                    SUM(BILINT_AMT) AS BILINT,
                    SUM(BILLC_AMT)  AS BILLC
                FROM V_FMSB_BIL_LNMEMO BIL
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = BIL.ARRANGEMENT_ID
                )
                GROUP BY BIL.ARRANGEMENT_ID
            )
            SELECT
                TO_NUMBER(PRE.ACCTNO), -- ACCTNO
                PRE.CURTYP, -- CURTYP
                CALC_CBAL_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- CBAL
                CALC_HOLD_VAL_FUNC(PRE.FROM_DATE, V_TODAY, PRE.LOCKED_AMOUNT), -- HOLD
                NVL(TO_NUMBER(PRE.DRLIMT), 0), -- DRLIMT
                CALC_ACCINT_VAL_FUNC(PRE.CURR_ASSET_TYPE, PRE.OPEN_BALANCE, PRE.CREDIT_MVMT, PRE.DEBIT_MVMT), -- ACCINT
                0, -- COMACC
                0, -- OTHCHG
                AGG.BILPRN, -- BILPRN
                AGG.BILINT, -- BILINT
                0, -- BILESC
                AGG.BILLC, -- BILLC
                0, -- BILOC
                0, -- BILMC
                PRE.WINDOW_ID, -- WINDOW_ID
                PRE.COMMIT_TS, -- COMMIT_TS
                PRE.REPLICAT_TS, -- REPLICAT_TS
                PRE.MAPPED_TS, -- MAPPED_TS
                'ECB' -- CALL_CDC
            FROM PRECOMPUTED PRE
            LEFT JOIN AGGREGATED AGG ON AGG.ARRANGEMENT_ID = PRE.ARR_RECID;

            DELETE FROM T24_LNMEMO_ACTIVITY_ECB
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_ECB_PROC;

END T24_LNMEMO_ACTIVITY_PKG;

CREATE OR REPLACE PACKAGE T24RAWOGG.T24_LNTNEW_ACTIVITY_PKG IS

    FUNCTION CALC_PMTAMT_VAL_FUNC(
        P_CALC_AMOUNT   IN VARCHAR2
    ) RETURN NUMBER;

    FUNCTION CALC_TYPE_VAL_FUNC(
        P_PRODUCT_STATUS IN VARCHAR2,
        P_PRODUCT        IN VARCHAR2
    ) RETURN VARCHAR2;

    FUNCTION CALC_FREQ_VAL_FUNC(
        P_BILL_TYPE    IN VARCHAR2,
        P_PROPERTY     IN VARCHAR2,
        P_PAYMENT_FREQ IN VARCHAR2
    ) RETURN NUMBER;
   
   	FUNCTION CALC_IPFREQ_VAL_FUNC(
        P_BILL_TYPE    IN VARCHAR2,
        P_PROPERTY     IN VARCHAR2,
        P_PAYMENT_FREQ IN VARCHAR2
    ) RETURN NUMBER;

    PROCEDURE GEN_FROM_ACC_PROC;

    PROCEDURE GEN_FROM_ARR_PROC;

    PROCEDURE GEN_FROM_AIT_PROC;

    PROCEDURE GEN_FROM_ASC_PROC;

END T24_LNTNEW_ACTIVITY_PKG;

CREATE OR REPLACE PACKAGE BODY T24RAWOGG.T24_LNTNEW_ACTIVITY_PKG IS 

---------------------------------------------------------------------------
-- CALC_PMTAMT_VAL_FUNC
---------------------------------------------------------------------------
    FUNCTION CALC_PMTAMT_VAL_FUNC(
        P_CALC_AMOUNT   IN VARCHAR2
    ) RETURN NUMBER IS
        V_PMTAMT        NUMBER := 0;
        V_START         PLS_INTEGER := 1;
        V_LEN           PLS_INTEGER := LENGTH(P_CALC_AMOUNT); 
        V_COLON_IDX     PLS_INTEGER;
        V_HASH_IDX      PLS_INTEGER;
        V_POS           VARCHAR2(6);
        V_CALC_AMOUNT   NUMBER;
    BEGIN
        IF P_CALC_AMOUNT IS NULL THEN
            RETURN 0;
        END IF;

        V_COLON_IDX := INSTR(P_CALC_AMOUNT, ':', V_START) + 1;
        V_HASH_IDX  := INSTR(P_CALC_AMOUNT, '#', V_COLON_IDX);

        IF V_HASH_IDX = 0 THEN
            V_HASH_IDX := V_LEN + 1;
        END IF;

        V_POS    := SUBSTR(P_CALC_AMOUNT, V_START, V_COLON_IDX - V_START);
        V_PMTAMT := T24_UTILS_PKG.GET_NUM_VAL_BY_POS_FUNC(P_CALC_AMOUNT, V_POS);

        RETURN V_PMTAMT;
    END CALC_PMTAMT_VAL_FUNC;

    FUNCTION CALC_TYPE_VAL_FUNC(
        P_PRODUCT_STATUS IN VARCHAR2,
        P_PRODUCT        IN VARCHAR2
    ) RETURN VARCHAR2 IS
        V_TYPE             VARCHAR2(30);
        V_START            PLS_INTEGER := 1;
        V_LEN              PLS_INTEGER := LENGTH(P_PRODUCT_STATUS);
        V_COLON_IDX        PLS_INTEGER;
        V_HASH_IDX         PLS_INTEGER;
        V_POS              VARCHAR2(6);
        V_PRODUCT_STATUS   VARCHAR2(255);
    BEGIN
        IF P_PRODUCT_STATUS IS NULL THEN
            RETURN 0;
        END IF;

        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_PRODUCT_STATUS, ':', V_START) + 1;
            V_HASH_IDX  := INSTR(P_PRODUCT_STATUS, '#', V_COLON_IDX);

            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS            := SUBSTR(P_PRODUCT_STATUS, V_START, V_COLON_IDX - V_START);
            V_PRODUCT_STATUS := SUBSTR(P_PRODUCT_STATUS, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);

            IF V_PRODUCT_STATUS IN ('CURRENT')
             THEN
                V_TYPE :=  T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_PRODUCT, V_POS);
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN V_TYPE;
    END CALC_TYPE_VAL_FUNC;

---------------------------------------------------------------------------
-- CALC_FREQ_VAL_FUNC
---------------------------------------------------------------------------
    FUNCTION CALC_FREQ_VAL_FUNC(
        P_BILL_TYPE    IN VARCHAR2,
        P_PROPERTY     IN VARCHAR2,
        P_PAYMENT_FREQ IN VARCHAR2
    ) RETURN NUMBER IS
        V_PAYMENT_FREQ VARCHAR2(255);
        V_START        PLS_INTEGER := 1;
        V_LEN          PLS_INTEGER := LENGTH(P_BILL_TYPE);
        V_COLON_IDX    PLS_INTEGER;
        V_HASH_IDX     PLS_INTEGER;
        V_POS          VARCHAR2(4);
        V_BILL_TYPE    VARCHAR2(20);
        V_PROPERTY     VARCHAR2(20);
        V_SPACE_1      NUMBER;
        V_SPACE_2      NUMBER;
        V_SPACE_3      NUMBER;
        V_SPACE_4      NUMBER;
        V_GROUP_1      VARCHAR2(20);
        V_GROUP_2      VARCHAR2(20);
        V_GROUP_3      VARCHAR2(20);
        V_GROUP_4      VARCHAR2(20);
        V_GROUP_5      VARCHAR2(20);
        D_GROUP_1      NUMBER;
        D_GROUP_2      NUMBER;
        D_GROUP_3      NUMBER;
        D_GROUP_4      NUMBER;
        D_GROUP_5      NUMBER;
        V_FREQ_RESULT  NUMBER;
       	V_FREQ_CURRENT NUMBER;
    BEGIN
        IF P_BILL_TYPE IS NULL THEN
            RETURN 0;
        END IF;

        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_BILL_TYPE, ':', V_START) + 1;
            V_HASH_IDX := INSTR(P_BILL_TYPE, '#', V_COLON_IDX);

            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS          := SUBSTR(P_BILL_TYPE, V_START, V_COLON_IDX - V_START);
            V_BILL_TYPE    := SUBSTR(P_BILL_TYPE, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);
            V_PROPERTY     := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_PROPERTY, V_POS);

            IF V_BILL_TYPE IN ('INSTALLMENT','INVESTORBILL','PAYMENT')
            AND V_PROPERTY = 'ACCOUNT'
            THEN
                V_PAYMENT_FREQ := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_PAYMENT_FREQ, V_POS);
               
               	IF V_PAYMENT_FREQ IS NOT NULL THEN
                    V_SPACE_1 := INSTR(V_PAYMENT_FREQ,' ',1,1);
                    V_SPACE_2 := INSTR(V_PAYMENT_FREQ,' ',1,2);
                    V_SPACE_3 := INSTR(V_PAYMENT_FREQ,' ',1,3);
                    V_SPACE_4 := INSTR(V_PAYMENT_FREQ,' ',1,4);

                    V_GROUP_1 := SUBSTR(V_PAYMENT_FREQ, 1, V_SPACE_1 -1);
                    V_GROUP_2 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_1 +1, V_SPACE_2- V_SPACE_1 -1);
                    V_GROUP_3 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_2 +1, V_SPACE_3- V_SPACE_2 -1);
                    V_GROUP_4 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_3 +1, V_SPACE_4- V_SPACE_3 -1);
                    V_GROUP_5 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_4 +1);

                    D_GROUP_1 := TO_NUMBER(SUBSTR(V_GROUP_1, 2, LENGTH(V_GROUP_1) -2));
                    D_GROUP_2 := TO_NUMBER(SUBSTR(V_GROUP_2, 2, LENGTH(V_GROUP_2) -2));
                    D_GROUP_3 := TO_NUMBER(SUBSTR(V_GROUP_3, 2, LENGTH(V_GROUP_3) -2));
                    D_GROUP_4 := TO_NUMBER(SUBSTR(V_GROUP_4, 2, LENGTH(V_GROUP_4) -2));

	                 V_FREQ_CURRENT:=
	                    CASE
	                        WHEN V_GROUP_5 = 'eLHFYRF' THEN 6
	                        WHEN V_GROUP_5 = 'eLMNTHF' THEN 1
	                        WHEN V_GROUP_5 = 'eLQUATF' THEN 3
	                        WHEN V_GROUP_5 = 'eLWEEKF' THEN 1
	                        WHEN V_GROUP_5 = 'eLYEARF' THEN 1
	                        WHEN SUBSTR(V_GROUP_4,1,1) = 'o' AND NVL(D_GROUP_2,0) <> 0 THEN D_GROUP_2
	                        WHEN SUBSTR(V_GROUP_4,1,1) = 'o' AND NVL(D_GROUP_3,0) <> 0 THEN D_GROUP_3
	                        WHEN NVL(D_GROUP_1,0) <> 0 THEN D_GROUP_1
	                        WHEN NVL(D_GROUP_2,0) <> 0 THEN D_GROUP_2
	                        WHEN NVL(D_GROUP_3,0) <> 0 THEN D_GROUP_3
	                        WHEN SUBSTR(V_GROUP_4,2,1) = 'B' THEN 1
	                        WHEN NVL(D_GROUP_4,0) <> 0 THEN D_GROUP_4
	                    END;
	               	V_FREQ_RESULT := GREATEST(NVL(V_FREQ_RESULT,0), V_FREQ_CURRENT);
	            END IF;
	        END IF;
			
            V_START := V_HASH_IDX;
        END LOOP;

        RETURN V_FREQ_RESULT;
    END CALC_FREQ_VAL_FUNC;

---------------------------------------------------------------------------
-- CALC_IPFREQ_VAL_FUNC
---------------------------------------------------------------------------   
    FUNCTION CALC_IPFREQ_VAL_FUNC(
        P_BILL_TYPE    IN VARCHAR2,
        P_PROPERTY     IN VARCHAR2,
        P_PAYMENT_FREQ IN VARCHAR2
    ) RETURN NUMBER IS
        V_PAYMENT_FREQ   VARCHAR2(255);
        V_START          PLS_INTEGER := 1;
        V_LEN            PLS_INTEGER := LENGTH(P_BILL_TYPE);
        V_COLON_IDX      PLS_INTEGER;
        V_HASH_IDX       PLS_INTEGER;
        V_POS            VARCHAR2(4);
        V_BILL_TYPE      VARCHAR2(255);
        V_PROPERTY       VARCHAR2(50);
        V_SPACE_1      NUMBER;
        V_SPACE_2      NUMBER;
        V_SPACE_3      NUMBER;
        V_SPACE_4      NUMBER;
        V_GROUP_1      VARCHAR2(20);
        V_GROUP_2      VARCHAR2(20);
        V_GROUP_3      VARCHAR2(20);
        V_GROUP_4      VARCHAR2(20);
        V_GROUP_5      VARCHAR2(20);
        D_GROUP_1      NUMBER;
        D_GROUP_2      NUMBER;
        D_GROUP_3      NUMBER;
        D_GROUP_4      NUMBER;
        V_IPFREQ_RESULT  NUMBER;
        V_IPFREQ_CURRENT NUMBER;
    BEGIN
        IF P_BILL_TYPE IS NULL THEN
            RETURN 0;
        END IF;

        WHILE V_START <= V_LEN LOOP
            V_COLON_IDX := INSTR(P_BILL_TYPE, ':', V_START) + 1;
            V_HASH_IDX := INSTR(P_BILL_TYPE, '#', V_COLON_IDX);

            IF V_HASH_IDX = 0 THEN
                V_HASH_IDX := V_LEN + 1;
            END IF;

            V_POS       := SUBSTR(P_BILL_TYPE, V_START, V_COLON_IDX - V_START);
            V_BILL_TYPE := SUBSTR(P_BILL_TYPE, V_COLON_IDX, V_HASH_IDX - V_COLON_IDX);
            V_PROPERTY  := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_PROPERTY, V_POS);

            IF V_BILL_TYPE IN ('INSTALLMENT','INVESTORBILL','PAYMENT')
            AND V_PROPERTY IN ('LOANINTEREST','LNINTPREBUY','INVESTORINT','RISKINTEREST')
            THEN
                V_PAYMENT_FREQ := T24_UTILS_PKG.GET_STR_VAL_BY_POS_FUNC(P_PAYMENT_FREQ, V_POS);
               		
               	IF V_PAYMENT_FREQ IS NOT NULL THEN
                    V_SPACE_1 := INSTR(V_PAYMENT_FREQ,' ',1,1);
                    V_SPACE_2 := INSTR(V_PAYMENT_FREQ,' ',1,2);
                    V_SPACE_3 := INSTR(V_PAYMENT_FREQ,' ',1,3);
                    V_SPACE_4 := INSTR(V_PAYMENT_FREQ,' ',1,4);

                    V_GROUP_1 := SUBSTR(V_PAYMENT_FREQ, 1, V_SPACE_1-1);
                    V_GROUP_2 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_1+1, V_SPACE_2-V_SPACE_1-1);
                    V_GROUP_3 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_2+1, V_SPACE_3-V_SPACE_2-1);
                    V_GROUP_4 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_3+1, V_SPACE_4-V_SPACE_3-1);
                    V_GROUP_5 := SUBSTR(V_PAYMENT_FREQ, V_SPACE_4+1);

                    D_GROUP_1 := TO_NUMBER(SUBSTR(V_GROUP_1, 2, LENGTH(V_GROUP_1)-2));
                    D_GROUP_2 := TO_NUMBER(SUBSTR(V_GROUP_2, 2, LENGTH(V_GROUP_2)-2));
                    D_GROUP_3 := TO_NUMBER(SUBSTR(V_GROUP_3, 2, LENGTH(V_GROUP_3)-2));
                    D_GROUP_4 := TO_NUMBER(SUBSTR(V_GROUP_4, 2, LENGTH(V_GROUP_4)-2));
	
	                V_IPFREQ_CURRENT :=
	                    CASE
	                        WHEN V_GROUP_5 = 'eLHFYRF' THEN 6
	                        WHEN V_GROUP_5 = 'eLMNTHF' THEN 1
	                        WHEN V_GROUP_5 = 'eLQUATF' THEN 3
	                        WHEN V_GROUP_5 = 'eLWEEKF' THEN 1
	                        WHEN V_GROUP_5 = 'eLYEARF' THEN 1
	                        WHEN SUBSTR(V_GROUP_4,1,1) = 'o' AND NVL(D_GROUP_2,0) <> 0 THEN D_GROUP_2
	                        WHEN SUBSTR(V_GROUP_4,1,1) = 'o' AND NVL(D_GROUP_3,0) <> 0 THEN D_GROUP_3
	                        WHEN NVL(D_GROUP_1,0) <> 0 THEN D_GROUP_1
	                        WHEN NVL(D_GROUP_2,0) <> 0 THEN D_GROUP_2
	                        WHEN NVL(D_GROUP_3,0) <> 0 THEN D_GROUP_3
	                        WHEN SUBSTR(V_GROUP_4,2,1) = 'B' THEN 1
	                        WHEN NVL(D_GROUP_4,0) <> 0 THEN D_GROUP_4
	                    END;
	                V_IPFREQ_RESULT := GREATEST(NVL(V_IPFREQ_RESULT,0), V_IPFREQ_CURRENT);
				END IF;        	 
            END IF;

            V_START := V_HASH_IDX;
        END LOOP;

        RETURN V_IPFREQ_RESULT;
    END CALC_IPFREQ_VAL_FUNC;

---------------------------------------------------------------------------
-- GEN_FROM_ACC_PROC
---------------------------------------------------------------------------   
    PROCEDURE GEN_FROM_ACC_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNTNEW_ACTIVITY_ACC CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_ACC_MAPPED ACC
            WHERE ACC.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= ACC.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNTNEW_ACTIVITY (
                BRN, ACCTNO, LNNUM, CIFNO, ACNAME, STATUS, TYPE,
                CURTYP, ORGAMT, DRLIMT, HOLD, CBAL, OTHCHG,
                ACCINT, COMACC, PMTAMT, FNLPMT, BILPRN, BILINT,
                BILESC, BILLC, BILOC, BILMC, BILLCO, YSOBAL,
                DATOPN, FRELDT, FULLDT, MATDT, RATE, LCTYPE,
                ACCMLC, TERM, TMCODE, FREQ, IPFREQ, ODIND, PURCOD,
                WINDOW_ID, COMMIT_TS, REPLICAT_TS, MAPPED_TS, CALL_CDC
            )
            WITH PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */
                    ACC.CO_CODE             AS BRN,
                    ACC.RECID               AS ACCTNO,
                    ARR.RECID               AS ARR_RECID,
                    ACC.CUSTOMER            AS CIFNO,
                    ACC.ACNAME              AS ACNAME,
                    ARR.ARR_STATUS          AS ARR_STATUS,
                    ARR.PRODUCT_STATUS      AS PRODUCT_STATUS, 
                    ARR.PRODUCT             AS PRODUCT,                
                    ACC.CURRENCY            AS CURTYP,
                    LMT.INTERNAL_AMOUNT     AS DRLIMT,
                    ARR.ORIG_CONTRACT_DATE  AS ORIG_CONTRACT_DATE,
                    ACC.OPENING_DATE        AS OPENING_DATE,
                    ACC.WINDOW_ID           AS WINDOW_ID,
                    ACC.COMMIT_TS           AS COMMIT_TS,
                    ACC.REPLICAT_TS         AS REPLICAT_TS,
                    ACC.MAPPED_TS           AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                JOIN V_FMSB_ACC_MAPPED ACC ON ACC.WINDOW_ID = V.COLUMN_VALUE
                JOIN V_FMSB_ARR_LNTNEW ARR ON ARR.LINKED_APPL_ID = ACC.RECID
                LEFT JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID = ACC.LIMIT_KEY
                WHERE ARR.START_DATE >= V_TODAY
            ),
            ARC_AGGREGATED AS (
                SELECT 
                    ARC.ARRANGEMENT,
                    MIN(ARC.EFFECTIVE_DATE) AS MIN_EFF_DAT,
                    MAX(ARC.EFFECTIVE_DATE) AS MAX_EFF_DAT
                FROM V_FMSB_ARC_LNTNEW ARC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ARC.ARRANGEMENT
                )
                AND EFFECTIVE_DATE <= TO_DATE(V_TODAY, 'YYYYMMDD')
                GROUP BY ARC.ARRANGEMENT
            ),
            ATA_AGGREGATED AS (
                SELECT 
                    ATA.ID_COMP_1,
                    MIN(ATA.ID_COMP_3) AS MIN_ID_COMP_3,
                    MAX(CASE 
                            WHEN ATA.ACTIVITY IN ('LENDING-NEW-ARRANGEMENT','LENDING-TAKEOVER-ARRANGEMENT')
                            THEN TO_NUMBER(ATA.AMOUNT)
                            ELSE 0
                        END) AS MAX_AMOUNT
                FROM V_FMSB_ATA_MAPPED ATA
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ATA.ID_COMP_1
                )
                GROUP BY ATA.ID_COMP_1
            ),
            ASC_AGGREGATED AS(
                SELECT 
                    ASCC.ID_COMP_1,
                    MAX(ASCC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_ASC_MAPPED ASCC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ASCC.ID_COMP_1
                )
                GROUP BY ASCC.ID_COMP_1
            ),
            AIT_AGGREGATED AS(
                SELECT
                    AIT.ID_COMP_1,
                    TO_NUMBER(AIT.EFFECTIVE_RATE)/100 AS RATE,
                    ROW_NUMBER() OVER (
                        PARTITION BY AIT.ID_COMP_1
                        ORDER BY AIT.ID_COMP_3 DESC,
                                CASE WHEN AIT.ID_COMP_2 = 'LOANINTEREST'
                                    THEN TO_NUMBER(AIT.ID_COMP_3)
                                    ELSE TO_NUMBER(AIT.ID_COMP_3) - 1
                                END DESC
                    ) AS RN
                FROM V_FMSB_AIT_LNTNEW AIT
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AIT.ID_COMP_1
                )
                AND AIT.ID_COMP_3 <= V_TODAY || '.9999'
            ),
            AAC_AGGREGATED AS(
                SELECT 
                    AAC.ID_COMP_1,
                    MAX(AAC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_AAC_MAPPED AAC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AAC.ID_COMP_1
                )
                AND ID_COMP_3 <= V_TODAY || '.9999'
                GROUP BY AAC.ID_COMP_1
            )
            SELECT
                PRE.BRN AS BRN,
                TO_NUMBER(PRE.ACCTNO) AS ACCTNO,
                0 AS LNNUM,
                TO_NUMBER(PRE.CIFNO) AS CIFNO,
                TRIM(PRE.ACNAME) AS ACNAME,
                CASE
                    WHEN PRE.ARR_STATUS IN ('CLOSE', 'PENDING.CLOSURE', 'CANCELLED') THEN 2
                    ELSE 4
                END AS STATUS,
                CALC_TYPE_VAL_FUNC(PRE.PRODUCT_STATUS, PRE.PRODUCT) AS TYPE,
                PRE.CURTYP AS CURTYP,
                ATA_AGG.MAX_AMOUNT AS ORGAMT,
                TO_NUMBER(PRE.DRLIMT) AS DRLIMT,
                0 AS HOLD,
                0 AS CBAL,
                0 AS OTHCHG,
                0 AS ACCINT,
                0 AS COMACC,
                CALC_PMTAMT_VAL_FUNC(ASCC.CALC_AMOUNT) AS PMTAMT,
                '' AS FNLPMT,
                0 AS BILPRN,
                0 AS BILINT,
                0 AS BILESC,
                0 AS BILLC,
                0 AS BILOC,
                0 AS BILMC,
                0 AS BILLCO,
                0 AS YSOBAL,
                TO_NUMBER(TO_CHAR(NVL(PRE.ORIG_CONTRACT_DATE, PRE.OPENING_DATE), 'YYYYDDD')) AS DATOPN,
                TO_NUMBER(TO_CHAR(ARC.MIN_EFF_DAT, 'YYYYDDD')) AS FRELDT,
                TO_NUMBER(TO_CHAR(ARC.MAX_EFF_DAT, 'YYYYDDD')) AS FULLDT,
                TO_NUMBER(TO_CHAR(NVL(ATA.MSB_OR_LNMAT_DT, ATA.MATURITY_DATE), 'YYYYDDD')) AS MATDT,
                AIT.RATE AS RATE,
                '' AS LCTYPE,
                '' AS ACCMLC,
                SUBSTR(ATA.TERM, 1, LENGTH(ATA.TERM)-1) AS TERM,
                SUBSTR(ATA.TERM, -1) AS TMCODE,
                CALC_FREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS FREQ,
                CALC_IPFREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS IPFREQ,
                'A' AS ODIND,
                AAC.MSB_LN_PURPOSE AS PURCOD,
                PRE.WINDOW_ID,
                PRE.COMMIT_TS,
                PRE.REPLICAT_TS,
                PRE.MAPPED_TS,
                'ACC'
            FROM PRECOMPUTED PRE
            LEFT JOIN ARC_AGGREGATED ARC ON ARC.ARRANGEMENT = PRE.ARR_RECID
            LEFT JOIN ATA_AGGREGATED ATA_AGG ON ATA_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ATA_MAPPED ATA ON ATA.ID_COMP_1 = ATA_AGG.ID_COMP_1 AND ATA.ID_COMP_3 = ATA_AGG.MIN_ID_COMP_3
            LEFT JOIN ASC_AGGREGATED ASCC_AGG ON ASCC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ASC_MAPPED ASCC ON ASCC.ID_COMP_1 = ASCC_AGG.ID_COMP_1 AND ASCC.ID_COMP_3 = ASCC_AGG.MAX_ID_COMP_3
            LEFT JOIN AAC_AGGREGATED AAC_AGG ON AAC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_AAC_MAPPED AAC ON AAC.ID_COMP_1 = AAC_AGG.ID_COMP_1 AND AAC.ID_COMP_3 = AAC_AGG.MAX_ID_COMP_3
            LEFT JOIN AIT_AGGREGATED AIT ON AIT.ID_COMP_1 = PRE.ARR_RECID AND AIT.RN = 1;

            DELETE FROM T24_LNTNEW_ACTIVITY_ACC
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_ACC_PROC;

---------------------------------------------------------------------------
-- GEN_FROM_ARR_PROC
---------------------------------------------------------------------------   
    PROCEDURE GEN_FROM_ARR_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNTNEW_ACTIVITY_ARR CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_ARR_LNTNEW ARR
            WHERE ARR.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= ARR.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNTNEW_ACTIVITY (
                BRN, ACCTNO, LNNUM, CIFNO, ACNAME, STATUS, TYPE,
                CURTYP, ORGAMT, DRLIMT, HOLD, CBAL, OTHCHG,
                ACCINT, COMACC, PMTAMT, FNLPMT, BILPRN, BILINT,
                BILESC, BILLC, BILOC, BILMC, BILLCO, YSOBAL,
                DATOPN, FRELDT, FULLDT, MATDT, RATE, LCTYPE,
                ACCMLC, TERM, TMCODE, FREQ, IPFREQ, ODIND, PURCOD,
                WINDOW_ID, COMMIT_TS, REPLICAT_TS, MAPPED_TS, CALL_CDC
            )
            WITH  PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */
                    ACC.CO_CODE             AS BRN,
                    ARR.LINKED_APPL_ID      AS ACCTNO,
                    ARR.RECID               AS ARR_RECID,
                    ACC.CUSTOMER            AS CIFNO,
                    ACC.ACNAME              AS ACNAME,
                    ARR.ARR_STATUS          AS ARR_STATUS,
                    ARR.PRODUCT_STATUS      AS PRODUCT_STATUS, 
                    ARR.PRODUCT             AS PRODUCT,                
                    ACC.CURRENCY            AS CURTYP,
                    LMT.INTERNAL_AMOUNT     AS DRLIMT,
                    ARR.ORIG_CONTRACT_DATE  AS ORIG_CONTRACT_DATE,
                    ACC.OPENING_DATE        AS OPENING_DATE,
                    ARR.WINDOW_ID           AS WINDOW_ID,
                    ARR.COMMIT_TS           AS COMMIT_TS,
                    ARR.REPLICAT_TS         AS REPLICAT_TS,
                    ARR.MAPPED_TS           AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                JOIN V_FMSB_ARR_LNTNEW ARR ON ARR.WINDOW_ID = V.COLUMN_VALUE
                JOIN V_FMSB_ACC_MAPPED ACC ON ACC.RECID = ARR.LINKED_APPL_ID
                LEFT JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID = ACC.LIMIT_KEY
                WHERE ARR.START_DATE >= V_TODAY
            ),
            ARC_AGGREGATED AS (
                SELECT 
                    ARC.ARRANGEMENT,
                    MIN(ARC.EFFECTIVE_DATE) AS MIN_EFF_DAT,
                    MAX(ARC.EFFECTIVE_DATE) AS MAX_EFF_DAT
                FROM V_FMSB_ARC_LNTNEW ARC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ARC.ARRANGEMENT
                )
                AND EFFECTIVE_DATE <= TO_DATE(V_TODAY, 'YYYYMMDD')
                GROUP BY ARC.ARRANGEMENT
            ),
            ATA_AGGREGATED AS (
                SELECT 
                    ATA.ID_COMP_1,
                    MIN(ATA.ID_COMP_3) AS MIN_ID_COMP_3,
                    MAX(CASE 
                            WHEN ATA.ACTIVITY IN ('LENDING-NEW-ARRANGEMENT','LENDING-TAKEOVER-ARRANGEMENT')
                            THEN TO_NUMBER(ATA.AMOUNT)
                            ELSE 0
                        END) AS MAX_AMOUNT
                FROM V_FMSB_ATA_MAPPED ATA
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ATA.ID_COMP_1
                )
                GROUP BY ATA.ID_COMP_1
            ),
            ASC_AGGREGATED AS(
                SELECT 
                    ASCC.ID_COMP_1,
                    MAX(ASCC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_ASC_MAPPED ASCC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ASCC.ID_COMP_1
                )
                GROUP BY ASCC.ID_COMP_1
            ),
            AIT_AGGREGATED AS(
                SELECT
                    AIT.ID_COMP_1,
                    TO_NUMBER(AIT.EFFECTIVE_RATE)/100 AS RATE,
                    ROW_NUMBER() OVER (
                        PARTITION BY AIT.ID_COMP_1
                        ORDER BY AIT.ID_COMP_3 DESC,
                                CASE WHEN AIT.ID_COMP_2 = 'LOANINTEREST'
                                    THEN TO_NUMBER(AIT.ID_COMP_3)
                                    ELSE TO_NUMBER(AIT.ID_COMP_3) - 1
                                END DESC
                    ) AS RN
                FROM V_FMSB_AIT_LNTNEW AIT
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AIT.ID_COMP_1
                )
                AND AIT.ID_COMP_3 <= V_TODAY || '.9999'
            ),
            AAC_AGGREGATED AS(
                SELECT 
                    AAC.ID_COMP_1,
                    MAX(AAC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_AAC_MAPPED AAC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AAC.ID_COMP_1
                )
                AND ID_COMP_3 <= V_TODAY || '.9999'
                GROUP BY AAC.ID_COMP_1
            )
            SELECT
                PRE.BRN AS BRN,
                TO_NUMBER(PRE.ACCTNO) AS ACCTNO,
                0 AS LNNUM,
                TO_NUMBER(PRE.CIFNO) AS CIFNO,
                TRIM(PRE.ACNAME) AS ACNAME,
                CASE
                    WHEN PRE.ARR_STATUS IN ('CLOSE', 'PENDING.CLOSURE', 'CANCELLED') THEN 2
                    ELSE 4
                END AS STATUS,
                CALC_TYPE_VAL_FUNC(PRE.PRODUCT_STATUS, PRE.PRODUCT) AS TYPE,
                PRE.CURTYP AS CURTYP,
                ATA_AGG.MAX_AMOUNT AS ORGAMT,
                TO_NUMBER(PRE.DRLIMT) AS DRLIMT,
                0 AS HOLD,
                0 AS CBAL,
                0 AS OTHCHG,
                0 AS ACCINT,
                0 AS COMACC,
                CALC_PMTAMT_VAL_FUNC(ASCC.CALC_AMOUNT) AS PMTAMT,
                '' AS FNLPMT,
                0 AS BILPRN,
                0 AS BILINT,
                0 AS BILESC,
                0 AS BILLC,
                0 AS BILOC,
                0 AS BILMC,
                0 AS BILLCO,
                0 AS YSOBAL,
                TO_NUMBER(TO_CHAR(NVL(PRE.ORIG_CONTRACT_DATE, PRE.OPENING_DATE), 'YYYYDDD')) AS DATOPN,
                TO_NUMBER(TO_CHAR(ARC.MIN_EFF_DAT, 'YYYYDDD')) AS FRELDT,
                TO_NUMBER(TO_CHAR(ARC.MAX_EFF_DAT, 'YYYYDDD')) AS FULLDT,
                TO_NUMBER(TO_CHAR(NVL(ATA.MSB_OR_LNMAT_DT, ATA.MATURITY_DATE), 'YYYYDDD')) AS MATDT,
                AIT.RATE AS RATE,
                '' AS LCTYPE,
                '' AS ACCMLC,
                SUBSTR(ATA.TERM, 1, LENGTH(ATA.TERM)-1) AS TERM,
                SUBSTR(ATA.TERM, -1) AS TMCODE,
                CALC_FREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS FREQ,
                CALC_IPFREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS IPFREQ,
                'A' AS ODIND,
                AAC.MSB_LN_PURPOSE AS PURCOD,
                PRE.WINDOW_ID,
                PRE.COMMIT_TS,
                PRE.REPLICAT_TS,
                PRE.MAPPED_TS,
                'ARR'
            FROM PRECOMPUTED PRE
            LEFT JOIN ARC_AGGREGATED ARC ON ARC.ARRANGEMENT = PRE.ARR_RECID
            LEFT JOIN ATA_AGGREGATED ATA_AGG ON ATA_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ATA_MAPPED ATA ON ATA.ID_COMP_1 = ATA_AGG.ID_COMP_1 AND ATA.ID_COMP_3 = ATA_AGG.MIN_ID_COMP_3
            LEFT JOIN ASC_AGGREGATED ASCC_AGG ON ASCC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ASC_MAPPED ASCC ON ASCC.ID_COMP_1 = ASCC_AGG.ID_COMP_1 AND ASCC.ID_COMP_3 = ASCC_AGG.MAX_ID_COMP_3
            LEFT JOIN AAC_AGGREGATED AAC_AGG ON AAC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_AAC_MAPPED AAC ON AAC.ID_COMP_1 = AAC_AGG.ID_COMP_1 AND AAC.ID_COMP_3 = AAC_AGG.MAX_ID_COMP_3
            LEFT JOIN AIT_AGGREGATED AIT ON AIT.ID_COMP_1 = PRE.ARR_RECID AND AIT.RN = 1;

            DELETE FROM T24_LNTNEW_ACTIVITY_ARR
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_ARR_PROC;

---------------------------------------------------------------------------
-- GEN_FROM_AIT_PROC
---------------------------------------------------------------------------   
    PROCEDURE GEN_FROM_AIT_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNTNEW_ACTIVITY_AIT CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_AIT_LNTNEW AIT
            WHERE AIT.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= AIT.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNTNEW_ACTIVITY (
                BRN, ACCTNO, LNNUM, CIFNO, ACNAME, STATUS, TYPE,
                CURTYP, ORGAMT, DRLIMT, HOLD, CBAL, OTHCHG,
                ACCINT, COMACC, PMTAMT, FNLPMT, BILPRN, BILINT,
                BILESC, BILLC, BILOC, BILMC, BILLCO, YSOBAL,
                DATOPN, FRELDT, FULLDT, MATDT, RATE, LCTYPE,
                ACCMLC, TERM, TMCODE, FREQ, IPFREQ, ODIND, PURCOD,
                WINDOW_ID, COMMIT_TS, REPLICAT_TS, MAPPED_TS, CALL_CDC
            )
            WITH PRECOMPUTED AS (
                SELECT /*+ MATERIALIZE */ 
                    ACC.CO_CODE             AS BRN,
                    ARR.LINKED_APPL_ID      AS ACCTNO,
                    ARR.RECID               AS ARR_RECID,
                    ACC.CUSTOMER            AS CIFNO,
                    ACC.ACNAME              AS ACNAME,
                    ARR.ARR_STATUS          AS ARR_STATUS,
                    ARR.PRODUCT_STATUS      AS PRODUCT_STATUS, 
                    ARR.PRODUCT             AS PRODUCT,                
                    ACC.CURRENCY            AS CURTYP,
                    LMT.INTERNAL_AMOUNT     AS DRLIMT,
                    ARR.ORIG_CONTRACT_DATE  AS ORIG_CONTRACT_DATE,
                    ACC.OPENING_DATE        AS OPENING_DATE,
                    AIT.WINDOW_ID           AS WINDOW_ID,
                    AIT.COMMIT_TS           AS COMMIT_TS,
                    AIT.REPLICAT_TS         AS REPLICAT_TS,
                    AIT.MAPPED_TS           AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                JOIN V_FMSB_AIT_LNTNEW AIT ON AIT.WINDOW_ID = V.COLUMN_VALUE
                JOIN V_FMSB_ARR_LNTNEW ARR ON ARR.RECID = AIT.ID_COMP_1
                JOIN V_FMSB_ACC_MAPPED ACC ON ACC.RECID = ARR.LINKED_APPL_ID
                LEFT JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID = ACC.LIMIT_KEY
                WHERE ARR.START_DATE >= V_TODAY
            ),
            ARC_AGGREGATED AS (
                SELECT 
                    ARC.ARRANGEMENT,
                    MIN(ARC.EFFECTIVE_DATE) AS MIN_EFF_DAT,
                    MAX(ARC.EFFECTIVE_DATE) AS MAX_EFF_DAT
                FROM V_FMSB_ARC_LNTNEW ARC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ARC.ARRANGEMENT
                )
                AND EFFECTIVE_DATE <= TO_DATE(V_TODAY, 'YYYYMMDD')
                GROUP BY ARC.ARRANGEMENT
            ),
            ATA_AGGREGATED AS (
                SELECT 
                    ATA.ID_COMP_1,
                    MIN(ATA.ID_COMP_3) AS MIN_ID_COMP_3,
                    MAX(CASE 
                            WHEN ATA.ACTIVITY IN ('LENDING-NEW-ARRANGEMENT','LENDING-TAKEOVER-ARRANGEMENT')
                            THEN TO_NUMBER(ATA.AMOUNT)
                            ELSE 0
                        END) AS MAX_AMOUNT
                FROM V_FMSB_ATA_MAPPED ATA
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ATA.ID_COMP_1
                )
                GROUP BY ATA.ID_COMP_1
            ),
            ASC_AGGREGATED AS(
                SELECT 
                    ASCC.ID_COMP_1,
                    MAX(ASCC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_ASC_MAPPED ASCC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ASCC.ID_COMP_1
                )
                GROUP BY ASCC.ID_COMP_1
            ),
            AIT_AGGREGATED AS(
                SELECT
                    AIT.ID_COMP_1,
                    TO_NUMBER(AIT.EFFECTIVE_RATE)/100 AS RATE,
                    ROW_NUMBER() OVER (
                        PARTITION BY AIT.ID_COMP_1
                        ORDER BY AIT.ID_COMP_3 DESC,
                                CASE WHEN AIT.ID_COMP_2 = 'LOANINTEREST'
                                    THEN TO_NUMBER(AIT.ID_COMP_3)
                                    ELSE TO_NUMBER(AIT.ID_COMP_3) - 1
                                END DESC
                    ) AS RN
                FROM V_FMSB_AIT_LNTNEW AIT
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AIT.ID_COMP_1
                )
                AND AIT.ID_COMP_3 <= V_TODAY || '.9999'
            ),
            AAC_AGGREGATED AS(
                SELECT 
                    AAC.ID_COMP_1,
                    MAX(AAC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_AAC_MAPPED AAC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AAC.ID_COMP_1
                )
                AND ID_COMP_3 <= V_TODAY || '.9999'
                GROUP BY AAC.ID_COMP_1
            )
            SELECT
                PRE.BRN AS BRN,
                TO_NUMBER(PRE.ACCTNO) AS ACCTNO,
                0 AS LNNUM,
                TO_NUMBER(PRE.CIFNO) AS CIFNO,
                TRIM(PRE.ACNAME) AS ACNAME,
                CASE
                    WHEN PRE.ARR_STATUS IN ('CLOSE', 'PENDING.CLOSURE', 'CANCELLED') THEN 2
                    ELSE 4
                END AS STATUS,
                CALC_TYPE_VAL_FUNC(PRE.PRODUCT_STATUS, PRE.PRODUCT) AS TYPE,
                PRE.CURTYP AS CURTYP,
                ATA_AGG.MAX_AMOUNT AS ORGAMT,
                TO_NUMBER(PRE.DRLIMT) AS DRLIMT,
                0 AS HOLD,
                0 AS CBAL,
                0 AS OTHCHG,
                0 AS ACCINT,
                0 AS COMACC,
                CALC_PMTAMT_VAL_FUNC(ASCC.CALC_AMOUNT) AS PMTAMT,
                '' AS FNLPMT,
                0 AS BILPRN,
                0 AS BILINT,
                0 AS BILESC,
                0 AS BILLC,
                0 AS BILOC,
                0 AS BILMC,
                0 AS BILLCO,
                0 AS YSOBAL,
                TO_NUMBER(TO_CHAR(NVL(PRE.ORIG_CONTRACT_DATE, PRE.OPENING_DATE), 'YYYYDDD')) AS DATOPN,
                TO_NUMBER(TO_CHAR(ARC.MIN_EFF_DAT, 'YYYYDDD')) AS FRELDT,
                TO_NUMBER(TO_CHAR(ARC.MAX_EFF_DAT, 'YYYYDDD')) AS FULLDT,
                TO_NUMBER(TO_CHAR(NVL(ATA.MSB_OR_LNMAT_DT, ATA.MATURITY_DATE), 'YYYYDDD')) AS MATDT,
                AIT.RATE AS RATE,
                '' AS LCTYPE,
                '' AS ACCMLC,
                SUBSTR(ATA.TERM, 1, LENGTH(ATA.TERM)-1) AS TERM,
                SUBSTR(ATA.TERM, -1) AS TMCODE,
                CALC_FREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS FREQ,
                CALC_IPFREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS IPFREQ,
                'A' AS ODIND,
                AAC.MSB_LN_PURPOSE AS PURCOD,
                PRE.WINDOW_ID,
                PRE.COMMIT_TS,
                PRE.REPLICAT_TS,
                PRE.MAPPED_TS,
                'AIT'
            FROM PRECOMPUTED PRE
            LEFT JOIN AIT_AGGREGATED AIT ON AIT.ID_COMP_1 = PRE.ARR_RECID AND AIT.RN = 1
            LEFT JOIN ARC_AGGREGATED ARC ON ARC.ARRANGEMENT = PRE.ARR_RECID
            LEFT JOIN ATA_AGGREGATED ATA_AGG ON ATA_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ATA_MAPPED ATA ON ATA.ID_COMP_1 = ATA_AGG.ID_COMP_1 AND ATA.ID_COMP_3 = ATA_AGG.MIN_ID_COMP_3
            LEFT JOIN ASC_AGGREGATED ASCC_AGG ON ASCC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ASC_MAPPED ASCC ON ASCC.ID_COMP_1 = ASCC_AGG.ID_COMP_1 AND ASCC.ID_COMP_3 = ASCC_AGG.MAX_ID_COMP_3
            LEFT JOIN AAC_AGGREGATED AAC_AGG ON AAC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_AAC_MAPPED AAC ON AAC.ID_COMP_1 = AAC_AGG.ID_COMP_1 AND AAC.ID_COMP_3 = AAC_AGG.MAX_ID_COMP_3;
            -- AND AIT.WINDOW_ID = PRE.WINDOW_ID;

            DELETE FROM T24_LNTNEW_ACTIVITY_AIT
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_AIT_PROC;

---------------------------------------------------------------------------
-- GEN_FROM_ASC_PROC
---------------------------------------------------------------------------   
    PROCEDURE GEN_FROM_ASC_PROC IS
        V_WINDOW_ID_LIST T_WINDOW_ID_ARRAY;
        V_TODAY          VARCHAR2(8);
    BEGIN
        SELECT CDC.WINDOW_ID
        BULK COLLECT INTO V_WINDOW_ID_LIST
        FROM T24_LNTNEW_ACTIVITY_ASC CDC
        WHERE EXISTS (
            SELECT 1
            FROM V_FMSB_ASC_MAPPED ASCC
            WHERE ASCC.RECID = CDC.RECID
            AND CDC.WINDOW_ID <= ASCC.WINDOW_ID
        );
        -- ) FETCH FIRST 5000 ROWS ONLY;

        IF V_WINDOW_ID_LIST.COUNT > 0 THEN
            SELECT /*+ RESULT_CACHE */ TODAY INTO V_TODAY
            FROM F_DAT_MAPPED
            WHERE RECID = 'VN0011000';

            INSERT INTO T24_LNTNEW_ACTIVITY (
                BRN, ACCTNO, LNNUM, CIFNO, ACNAME, STATUS, TYPE,
                CURTYP, ORGAMT, DRLIMT, HOLD, CBAL, OTHCHG,
                ACCINT, COMACC, PMTAMT, FNLPMT, BILPRN, BILINT,
                BILESC, BILLC, BILOC, BILMC, BILLCO, YSOBAL,
                DATOPN, FRELDT, FULLDT, MATDT, RATE, LCTYPE,
                ACCMLC, TERM, TMCODE, FREQ, IPFREQ, ODIND, PURCOD,
                WINDOW_ID, COMMIT_TS, REPLICAT_TS, MAPPED_TS, CALL_CDC
            )
            WITH /*+ MATERIALIZE */ PRECOMPUTED AS (
                SELECT
                    ACC.CO_CODE             AS BRN,
                    ARR.LINKED_APPL_ID      AS ACCTNO,
                    ARR.RECID               AS ARR_RECID,
                    ACC.CUSTOMER            AS CIFNO,
                    ACC.ACNAME              AS ACNAME,
                    ARR.ARR_STATUS          AS ARR_STATUS,
                    ARR.PRODUCT_STATUS      AS PRODUCT_STATUS, 
                    ARR.PRODUCT             AS PRODUCT,                
                    ACC.CURRENCY            AS CURTYP,
                    LMT.INTERNAL_AMOUNT     AS DRLIMT,
                    ARR.ORIG_CONTRACT_DATE  AS ORIG_CONTRACT_DATE,
                    ACC.OPENING_DATE        AS OPENING_DATE,
                    ASCC.WINDOW_ID          AS WINDOW_ID,
                    ASCC.COMMIT_TS          AS COMMIT_TS,
                    ASCC.REPLICAT_TS        AS REPLICAT_TS,
                    ASCC.MAPPED_TS          AS MAPPED_TS
                FROM TABLE(V_WINDOW_ID_LIST) V
                JOIN V_FMSB_ASC_MAPPED ASCC ON ASCC.WINDOW_ID = V.COLUMN_VALUE
                JOIN V_FMSB_ARR_LNTNEW ARR ON ARR.RECID = ASCC.ID_COMP_1
                JOIN V_FMSB_ACC_MAPPED ACC ON ACC.RECID = ARR.LINKED_APPL_ID
                LEFT JOIN V_FMSB_LMT_MAPPED LMT ON LMT.RECID = ACC.LIMIT_KEY
                WHERE ARR.START_DATE >= V_TODAY
            ),
            ARC_AGGREGATED AS (
                SELECT 
                    ARC.ARRANGEMENT,
                    MIN(ARC.EFFECTIVE_DATE) AS MIN_EFF_DAT,
                    MAX(ARC.EFFECTIVE_DATE) AS MAX_EFF_DAT
                FROM V_FMSB_ARC_LNTNEW ARC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ARC.ARRANGEMENT
                )
                AND EFFECTIVE_DATE <= TO_DATE(V_TODAY, 'YYYYMMDD')
                GROUP BY ARC.ARRANGEMENT
            ),
            ATA_AGGREGATED AS (
                SELECT 
                    ATA.ID_COMP_1,
                    MIN(ATA.ID_COMP_3) AS MIN_ID_COMP_3,
                    MAX(CASE 
                            WHEN ATA.ACTIVITY IN ('LENDING-NEW-ARRANGEMENT','LENDING-TAKEOVER-ARRANGEMENT')
                            THEN TO_NUMBER(ATA.AMOUNT)
                            ELSE 0
                        END) AS MAX_AMOUNT
                FROM V_FMSB_ATA_MAPPED ATA
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ATA.ID_COMP_1
                )
                GROUP BY ATA.ID_COMP_1
            ),
            ASC_AGGREGATED AS(
                SELECT 
                    ASCC.ID_COMP_1,
                    MAX(ASCC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_ASC_MAPPED ASCC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = ASCC.ID_COMP_1
                )
                GROUP BY ASCC.ID_COMP_1
            ),
            AIT_AGGREGATED AS(
                SELECT
                    AIT.ID_COMP_1,
                    TO_NUMBER(AIT.EFFECTIVE_RATE)/100 AS RATE,
                    ROW_NUMBER() OVER (
                        PARTITION BY AIT.ID_COMP_1
                        ORDER BY AIT.ID_COMP_3 DESC,
                                CASE WHEN AIT.ID_COMP_2 = 'LOANINTEREST'
                                    THEN TO_NUMBER(AIT.ID_COMP_3)
                                    ELSE TO_NUMBER(AIT.ID_COMP_3) - 1
                                END DESC
                    ) AS RN
                FROM V_FMSB_AIT_LNTNEW AIT
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AIT.ID_COMP_1
                )
                AND AIT.ID_COMP_3 <= V_TODAY || '.9999'
            ),
            AAC_AGGREGATED AS(
                SELECT 
                    AAC.ID_COMP_1,
                    MAX(AAC.ID_COMP_3) AS MAX_ID_COMP_3
                FROM V_FMSB_AAC_MAPPED AAC
                WHERE EXISTS (
                    SELECT 1
                    FROM PRECOMPUTED PRE
                    WHERE PRE.ARR_RECID = AAC.ID_COMP_1
                )
                AND ID_COMP_3 <= V_TODAY || '.9999'
                GROUP BY AAC.ID_COMP_1
            )
            SELECT
                PRE.BRN AS BRN,
                TO_NUMBER(PRE.ACCTNO) AS ACCTNO,
                0 AS LNNUM,
                TO_NUMBER(PRE.CIFNO) AS CIFNO,
                TRIM(PRE.ACNAME) AS ACNAME,
                CASE
                    WHEN PRE.ARR_STATUS IN ('CLOSE', 'PENDING.CLOSURE', 'CANCELLED') THEN 2
                    ELSE 4
                END AS STATUS,
                CALC_TYPE_VAL_FUNC(PRE.PRODUCT_STATUS, PRE.PRODUCT) AS TYPE,
                PRE.CURTYP AS CURTYP,
                ATA_AGG.MAX_AMOUNT AS ORGAMT,
                TO_NUMBER(PRE.DRLIMT) AS DRLIMT,
                0 AS HOLD,
                0 AS CBAL,
                0 AS OTHCHG,
                0 AS ACCINT,
                0 AS COMACC,
                CALC_PMTAMT_VAL_FUNC(ASCC.CALC_AMOUNT) AS PMTAMT,
                '' AS FNLPMT,
                0 AS BILPRN,
                0 AS BILINT,
                0 AS BILESC,
                0 AS BILLC,
                0 AS BILOC,
                0 AS BILMC,
                0 AS BILLCO,
                0 AS YSOBAL,
                TO_NUMBER(TO_CHAR(NVL(PRE.ORIG_CONTRACT_DATE, PRE.OPENING_DATE), 'YYYYDDD')) AS DATOPN,
                TO_NUMBER(TO_CHAR(ARC.MIN_EFF_DAT, 'YYYYDDD')) AS FRELDT,
                TO_NUMBER(TO_CHAR(ARC.MAX_EFF_DAT, 'YYYYDDD')) AS FULLDT,
                TO_NUMBER(TO_CHAR(NVL(ATA.MSB_OR_LNMAT_DT, ATA.MATURITY_DATE), 'YYYYDDD')) AS MATDT,
                AIT.RATE AS RATE,
                '' AS LCTYPE,
                '' AS ACCMLC,
                SUBSTR(ATA.TERM, 1, LENGTH(ATA.TERM)-1) AS TERM,
                SUBSTR(ATA.TERM, -1) AS TMCODE,
                CALC_FREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS FREQ,
                CALC_IPFREQ_VAL_FUNC(ASCC.BILL_TYPE, ASCC.PROPERTY, ASCC.PAYMENT_FREQ) AS IPFREQ,
                'A' AS ODIND,
                AAC.MSB_LN_PURPOSE AS PURCOD,
                PRE.WINDOW_ID,
                PRE.COMMIT_TS,
                PRE.REPLICAT_TS,
                PRE.MAPPED_TS,
                'ASC'
            FROM PRECOMPUTED PRE
            LEFT JOIN ASC_AGGREGATED ASCC_AGG ON ASCC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ASC_MAPPED ASCC ON ASCC.ID_COMP_1 = ASCC_AGG.ID_COMP_1 AND ASCC.ID_COMP_3 = ASCC_AGG.MAX_ID_COMP_3
            LEFT JOIN ARC_AGGREGATED ARC ON ARC.ARRANGEMENT = PRE.ARR_RECID
            LEFT JOIN ATA_AGGREGATED ATA_AGG ON ATA_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_ATA_MAPPED ATA ON ATA.ID_COMP_1 = ATA_AGG.ID_COMP_1 AND ATA.ID_COMP_3 = ATA_AGG.MIN_ID_COMP_3
            LEFT JOIN AAC_AGGREGATED AAC_AGG ON AAC_AGG.ID_COMP_1 = PRE.ARR_RECID
            LEFT JOIN V_FMSB_AAC_MAPPED AAC ON AAC.ID_COMP_1 = AAC_AGG.ID_COMP_1 AND AAC.ID_COMP_3 = AAC_AGG.MAX_ID_COMP_3
            LEFT JOIN AIT_AGGREGATED AIT ON AIT.ID_COMP_1 = PRE.ARR_RECID AND AIT.RN = 1 ;

            DELETE FROM T24_LNTNEW_ACTIVITY_ASC
            WHERE WINDOW_ID MEMBER OF V_WINDOW_ID_LIST;
        END IF;

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;
            RAISE;
    END GEN_FROM_ASC_PROC;      
    
END T24_LNTNEW_ACTIVITY_PKG;

BEGIN
    DBMS_SCHEDULER.create_job(
        job_name         => 'T24RAWOGG.DAILY_PURGE_OP_TYPE_D_JOB',
        job_type         => 'PLSQL_BLOCK',
        job_action       => q'[
            BEGIN
                DELETE FROM FMSB_ARR_LNMEMO WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_BIL_LNMEMO WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_AIT_LNTNEW WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ARC_LNTNEW WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ARR_LNTNEW WHERE OP_TYPE = 'D';
                DELETE FROM F_DAT_MAPPED    WHERE OP_TYPE = 'D';
                DELETE FROM F_POR_MAPPED    WHERE OP_TYPE = 'D';
                DELETE FROM F_PST_MAPPED    WHERE OP_TYPE = 'D';
                DELETE FROM F_SUP_MAPPED    WHERE OP_TYPE = 'D';
                DELETE FROM F_TMV_MAPPED    WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_AAC_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_AC_MAPPED  WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ACC_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ADL_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_AIT_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ARC_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ARR_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ASC_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ATA_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_BIL_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_BIT_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_CAT_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_CHG_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_ECB_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_FT_MAPPED  WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_FX_MAPPED  WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_LMT_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_REC_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_STM_MAPPED WHERE OP_TYPE = 'D';
                DELETE FROM FMSB_TR_MAPPED  WHERE OP_TYPE = 'D';
                COMMIT;
            END;
        ]',
        start_date       => SYSTIMESTAMP,
        repeat_interval  => 'FREQ=DAILY;BYHOUR=5;BYMINUTE=0;BYSECOND=0',
        enabled          => FALSE,
        auto_drop        => FALSE
    );
END;

-- ACC
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_ACC_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNMEMO_ACTIVITY_PKG.GEN_FROM_ACC_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_ACC_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- ARR
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_ARR_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNMEMO_ACTIVITY_PKG.GEN_FROM_ARR_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_ARR_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- BIL
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_BIL_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNMEMO_ACTIVITY_PKG.GEN_FROM_BIL_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_BIL_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- ECB
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_ECB_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNMEMO_ACTIVITY_PKG.GEN_FROM_ECB_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNMEMO_ACTIVITY_GEN_FROM_ECB_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- ACC
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_ACC_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[ 
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNTNEW_ACTIVITY_PKG.GEN_FROM_ACC_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_ACC_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- ARR
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_ARR_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNTNEW_ACTIVITY_PKG.GEN_FROM_ARR_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_ARR_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- AIT
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_AIT_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNTNEW_ACTIVITY_PKG.GEN_FROM_AIT_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_AIT_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;

-- ASC
BEGIN
    DBMS_SCHEDULER.create_job(
        job_name   => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_ASC_JOB',
        job_type   => 'PLSQL_BLOCK',
        job_action => q'[
            BEGIN
                EXECUTE IMMEDIATE 'ALTER SESSION SET NLS_NUMERIC_CHARACTERS = ''.,''';
                LOOP
                    T24RAWOGG.T24_LNTNEW_ACTIVITY_PKG.GEN_FROM_ASC_PROC;
                END LOOP;
            END;
        ]',
        start_date => SYSTIMESTAMP,
        enabled    => FALSE,
        auto_drop  => FALSE
    );

    DBMS_SCHEDULER.set_attribute(
        name      => 'T24RAWOGG.T24_LNTNEW_ACTIVITY_GEN_FROM_ASC_JOB',
        attribute => 'instance_id',
        value     => 1
    );
END;





